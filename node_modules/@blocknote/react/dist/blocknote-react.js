var jt = Object.defineProperty;
var Ge = (e) => {
  throw TypeError(e);
};
var Wt = (e, t, n) => t in e ? jt(e, t, { enumerable: !0, configurable: !0, writable: !0, value: n }) : e[t] = n;
var L = (e, t, n) => Wt(e, typeof t != "symbol" ? t + "" : t, n), qt = (e, t, n) => t.has(e) || Ge("Cannot " + n);
var Ue = (e, t, n) => t.has(e) ? Ge("Cannot add the same private member more than once") : t instanceof WeakSet ? t.add(e) : t.set(e, n);
var ke = (e, t, n) => (qt(e, t, "access private method"), n);
import P, { createContext as Be, useContext as Te, useEffect as x, useState as w, useCallback as f, useMemo as y, useRef as N, useSyncExternalStore as Se, useLayoutEffect as $t, forwardRef as Kt, useImperativeHandle as Xt, useReducer as Yt } from "react";
import { jsxs as v, Fragment as S, jsx as i } from "react/jsx-runtime";
import { useFloating as Le, useTransitionStyles as _e, useDismiss as Jt, useInteractions as Qt, offset as A, shift as ue, flip as W, size as Re, FloatingPortal as en } from "@floating-ui/react";
import { BlockNoteEditor as tn, BlockNoteSchema as nn, defaultStyleSpecs as on, createBlockSpecFromStronglyTypedTiptapNode as rn, createStronglyTypedTiptapNode as Ee, defaultBlockSpecs as ln, mergeCSSClasses as _, filenameFromURL as ze, formatKeyboardShortcut as me, VALID_LINK_PROTOCOLS as cn, DEFAULT_LINK_PROTOCOL as an, isTableCellSelection as sn, checkBlockIsFileBlock as J, checkBlockIsFileBlockWithPlaceholder as Q, checkBlockIsFileBlockWithPreview as dn, checkBlockHasDefaultProp as Me, mapTableCell as K, checkBlockTypeHasDefaultProp as $, getDefaultEmojiPickerItems as un, getDefaultSlashMenuItems as mn, filterSuggestionItems as hn, EMPTY_CELL_WIDTH as gn, EMPTY_CELL_HEIGHT as fn, isTableCell as X, getColspan as lt, getRowspan as ct, getBlockFromPos as bn, applyNonSelectableBlockFix as Cn, wrapInBlockStructure as pn, getParseRules as kn, propsToAttributes as at, createInternalBlockSpec as wn, inheritedProps as vn, camelToDataKebab as st, audioParse as Hn, audioBlockConfig as Mn, fileParse as yn, fileBlockConfig as xn, imageParse as Vn, imageBlockConfig as Bn, getPageBreakSlashMenuItems as Tn, videoParse as Sn, videoBlockConfig as Ln, defaultToggledState as ne, UnreachableCaseError as dt, nodeToCustomInlineContent as je, inlineContentToNodes as _n, addInlineContentAttributes as Rn, getInlineContentParseRules as En, addInlineContentKeyboardShortcuts as In, createInternalInlineContentSpec as Nn, addStyleAttributes as Pn, getStyleParseRules as Zn, stylePropsToAttributes as Dn, createInternalStyleSpec as On } from "@blocknote/core";
import { createPortal as he, flushSync as ut } from "react-dom";
import { ReactNodeViewRenderer as mt, useReactNodeView as ht, NodeViewWrapper as gt, Mark as Fn } from "@tiptap/react";
import { createRoot as An } from "react-dom/client";
const ft = Be(void 0);
function D(e) {
  return Te(ft);
}
function C(e) {
  const t = D();
  if (!(t != null && t.editor))
    throw new Error(
      "useBlockNoteEditor was called outside of a BlockNoteContext provider or BlockNoteView component"
    );
  return t.editor;
}
function ge(e, t, n) {
  const o = D();
  t || (t = o == null ? void 0 : o.editor), x(() => {
    if (!t)
      throw new Error(
        "'editor' is required, either from BlockNoteContext or as a function argument"
      );
    return t.onSelectionChange(e, n);
  }, [e, t, n]);
}
function Gn(e, t) {
  const n = C();
  t = t || n;
  const [o, r] = w(() => {
    if (e)
      return t.getSelectionBoundingBox();
  }), l = f(() => {
    if (!e)
      return;
    const c = t.getSelectionBoundingBox();
    r(c);
  }, [t, e]);
  return ge(l, t, !0), x(() => {
    r(e ? t.getSelectionBoundingBox() : void 0);
  }, [e, t]), o;
}
function Un(e) {
  return e.getBoundingClientRect !== void 0;
}
function G(e, t, n, o) {
  const { refs: r, update: l, context: c, floatingStyles: s, isPositioned: d } = Le({
    open: e,
    ...o
  }), { isMounted: a, styles: u } = _e(c), h = typeof (o == null ? void 0 : o.canDismiss) == "object" ? o.canDismiss : {
    enabled: o == null ? void 0 : o.canDismiss
  }, m = Jt(c, h), { getReferenceProps: g, getFloatingProps: H } = Qt([m]);
  return x(() => {
    l();
  }, [t, l]), x(() => {
    t !== null && (t instanceof HTMLElement || Un(t) ? r.setReference(t) : r.setReference({
      getBoundingClientRect: () => t
    }));
  }, [t, r]), y(() => ({
    isMounted: a,
    ref: r.setFloating,
    setReference: r.setReference,
    style: {
      display: "flex",
      ...u,
      ...s,
      zIndex: n
    },
    getFloatingProps: H,
    getReferenceProps: g,
    isPositioned: d
  }), [
    d,
    s,
    a,
    r.setFloating,
    r.setReference,
    u,
    n,
    H,
    g
  ]);
}
function Z(e) {
  const [t, n] = w();
  return x(() => e((o) => {
    n({ ...o });
  }), [e]), t;
}
const zn = Be(
  void 0
);
function p() {
  return Te(zn);
}
const fe = (e = {}, t = []) => y(() => {
  const n = tn.create(e);
  return window && (window.ProseMirror = n._tiptapEditor), n;
}, t), $i = fe;
function M() {
  return D().editor.dictionary;
}
function ee(e, t) {
  const n = D();
  t || (t = n == null ? void 0 : n.editor), x(() => {
    if (!t)
      throw new Error(
        "'editor' is required, either from BlockNoteContext or as a function argument"
      );
    return t.onChange(e);
  }, [e, t]);
}
const Ie = (e) => {
  const [t, n] = w(!1), [o, r] = w(e.editor.isEmpty), l = p();
  ee(() => {
    r(e.editor.isEmpty);
  }, e.editor);
  const c = f(() => {
    n(!0);
  }, []), s = f(() => {
    n(!1);
  }, []);
  return x(() => {
    e.editable && e.autoFocus && e.editor.focus();
  }, [e.autoFocus, e.editable, e.editor]), /* @__PURE__ */ v(S, { children: [
    /* @__PURE__ */ i(
      l.Comments.Editor,
      {
        autoFocus: e.autoFocus,
        className: "bn-comment-editor",
        editor: e.editor,
        onFocus: c,
        onBlur: s,
        editable: e.editable
      }
    ),
    e.actions && /* @__PURE__ */ i("div", { className: "bn-comment-actions-wrapper", children: /* @__PURE__ */ i(e.actions, { isFocused: t, isEmpty: o }) })
  ] });
}, jn = rn(
  Ee(
    ln.paragraph.implementation.node.config
  ),
  // disable default props on paragraph (such as textalignment and colors)
  {}
), { textColor: Ki, backgroundColor: Xi, ...Wn } = on, Ne = nn.create({
  blockSpecs: {
    paragraph: jn
  },
  styleSpecs: Wn
});
function qn() {
  const e = C();
  if (!e.comments)
    throw new Error("Comments plugin not found");
  const t = e.comments, n = p(), o = M(), r = fe({
    trailingBlock: !1,
    dictionary: {
      ...o,
      placeholders: {
        emptyDocument: o.placeholders.new_comment
      }
    },
    schema: Ne,
    sideMenuDetection: "editor"
  });
  return /* @__PURE__ */ i(n.Comments.Card, { className: "bn-thread", children: /* @__PURE__ */ i(
    Ie,
    {
      autoFocus: !0,
      editable: !0,
      editor: r,
      actions: ({ isEmpty: l }) => /* @__PURE__ */ i(
        n.Generic.Toolbar.Root,
        {
          className: _(
            "bn-action-toolbar",
            "bn-comment-actions"
          ),
          variant: "action-toolbar",
          children: /* @__PURE__ */ i(
            n.Generic.Toolbar.Button,
            {
              className: "bn-button",
              mainTooltip: "Save",
              variant: "compact",
              isDisabled: l,
              onClick: async () => {
                await t.createThread({
                  initialComment: {
                    body: r.document
                  }
                }), t.stopPendingComment();
              },
              children: "Save"
            }
          )
        }
      )
    }
  ) });
}
const $n = (e) => {
  const t = C();
  if (!t.comments)
    throw new Error(
      "FloatingComposerController can only be used when BlockNote editor has enabled comments"
    );
  const n = t.comments;
  x(() => {
    const u = n.onUpdate(
      (h) => t.setForceSelectionVisible(h.pendingComment)
    );
    return () => u();
  }, [n, t]);
  const o = Z(n.onUpdate.bind(n)), r = Gn(o == null ? void 0 : o.pendingComment), { isMounted: l, ref: c, style: s, getFloatingProps: d } = G(
    (o == null ? void 0 : o.pendingComment) || !1,
    r || null,
    5e3,
    {
      placement: "bottom",
      middleware: [A(10), ue(), W()],
      onOpenChange: (u) => {
        u || (n.stopPendingComment(), t.focus());
      },
      ...e.floatingOptions
    }
  );
  if (!l || !o)
    return null;
  const a = e.floatingComposer || qn;
  return /* @__PURE__ */ i("div", { ref: c, style: s, ...d(), children: /* @__PURE__ */ i(a, {}) });
};
var bt = {
  color: void 0,
  size: void 0,
  className: void 0,
  style: void 0,
  attr: void 0
}, We = P.createContext && /* @__PURE__ */ P.createContext(bt), Kn = ["attr", "size", "title"];
function Xn(e, t) {
  if (e == null) return {};
  var n = Yn(e, t), o, r;
  if (Object.getOwnPropertySymbols) {
    var l = Object.getOwnPropertySymbols(e);
    for (r = 0; r < l.length; r++)
      o = l[r], !(t.indexOf(o) >= 0) && Object.prototype.propertyIsEnumerable.call(e, o) && (n[o] = e[o]);
  }
  return n;
}
function Yn(e, t) {
  if (e == null) return {};
  var n = {};
  for (var o in e)
    if (Object.prototype.hasOwnProperty.call(e, o)) {
      if (t.indexOf(o) >= 0) continue;
      n[o] = e[o];
    }
  return n;
}
function ie() {
  return ie = Object.assign ? Object.assign.bind() : function(e) {
    for (var t = 1; t < arguments.length; t++) {
      var n = arguments[t];
      for (var o in n)
        Object.prototype.hasOwnProperty.call(n, o) && (e[o] = n[o]);
    }
    return e;
  }, ie.apply(this, arguments);
}
function qe(e, t) {
  var n = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var o = Object.getOwnPropertySymbols(e);
    t && (o = o.filter(function(r) {
      return Object.getOwnPropertyDescriptor(e, r).enumerable;
    })), n.push.apply(n, o);
  }
  return n;
}
function le(e) {
  for (var t = 1; t < arguments.length; t++) {
    var n = arguments[t] != null ? arguments[t] : {};
    t % 2 ? qe(Object(n), !0).forEach(function(o) {
      Jn(e, o, n[o]);
    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n)) : qe(Object(n)).forEach(function(o) {
      Object.defineProperty(e, o, Object.getOwnPropertyDescriptor(n, o));
    });
  }
  return e;
}
function Jn(e, t, n) {
  return t = Qn(t), t in e ? Object.defineProperty(e, t, { value: n, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = n, e;
}
function Qn(e) {
  var t = eo(e, "string");
  return typeof t == "symbol" ? t : t + "";
}
function eo(e, t) {
  if (typeof e != "object" || !e) return e;
  var n = e[Symbol.toPrimitive];
  if (n !== void 0) {
    var o = n.call(e, t);
    if (typeof o != "object") return o;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }
  return (t === "string" ? String : Number)(e);
}
function Ct(e) {
  return e && e.map((t, n) => /* @__PURE__ */ P.createElement(t.tag, le({
    key: n
  }, t.attr), Ct(t.child)));
}
function k(e) {
  return (t) => /* @__PURE__ */ P.createElement(to, ie({
    attr: le({}, e.attr)
  }, t), Ct(e.child));
}
function to(e) {
  var t = (n) => {
    var {
      attr: o,
      size: r,
      title: l
    } = e, c = Xn(e, Kn), s = r || n.size || "1em", d;
    return n.className && (d = n.className), e.className && (d = (d ? d + " " : "") + e.className), /* @__PURE__ */ P.createElement("svg", ie({
      stroke: "currentColor",
      fill: "currentColor",
      strokeWidth: "0"
    }, n.attr, o, c, {
      className: d,
      style: le(le({
        color: e.color || n.color
      }, n.style), e.style),
      height: s,
      width: s,
      xmlns: "http://www.w3.org/2000/svg"
    }), l && /* @__PURE__ */ P.createElement("title", null, l), e.children);
  };
  return We !== void 0 ? /* @__PURE__ */ P.createElement(We.Consumer, null, (n) => t(n)) : t(bt);
}
function no(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M8 7V11L2 6L8 1V5H13C17.4183 5 21 8.58172 21 13C21 17.4183 17.4183 21 13 21H4V19H13C16.3137 19 19 16.3137 19 13C19 9.68629 16.3137 7 13 7H8Z" }, child: [] }] })(e);
}
function pt(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M7.29117 20.8242L2 22L3.17581 16.7088C2.42544 15.3056 2 13.7025 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C10.2975 22 8.6944 21.5746 7.29117 20.8242ZM7.58075 18.711L8.23428 19.0605C9.38248 19.6745 10.6655 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 13.3345 4.32549 14.6175 4.93949 15.7657L5.28896 16.4192L4.63416 19.3658L7.58075 18.711Z" }, child: [] }] })(e);
}
function oo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M7.24264 17.9967H3V13.754L14.435 2.319C14.8256 1.92848 15.4587 1.92848 15.8492 2.319L18.6777 5.14743C19.0682 5.53795 19.0682 6.17112 18.6777 6.56164L7.24264 17.9967ZM3 19.9967H21V21.9967H3V19.9967Z" }, child: [] }] })(e);
}
function ro(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M23 12L15.9289 19.0711L14.5147 17.6569L20.1716 12L14.5147 6.34317L15.9289 4.92896L23 12ZM3.82843 12L9.48528 17.6569L8.07107 19.0711L1 12L8.07107 4.92896L9.48528 6.34317L3.82843 12Z" }, child: [] }] })(e);
}
function Pe(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M3 8L9.00319 2H19.9978C20.5513 2 21 2.45531 21 2.9918V21.0082C21 21.556 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5501 3 20.9932V8ZM10 4V9H5V20H19V4H10Z" }, child: [] }] })(e);
}
function io(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M3 4H21V6H3V4ZM5 19H19V21H5V19ZM3 14H21V16H3V14ZM5 9H19V11H5V9Z" }, child: [] }] })(e);
}
function lo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M3 4H21V6H3V4ZM3 19H21V21H3V19ZM3 14H21V16H3V14ZM3 9H21V11H3V9Z" }, child: [] }] })(e);
}
function co(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M3 4H21V6H3V4ZM3 19H17V21H3V19ZM3 14H21V16H3V14ZM3 9H17V11H3V9Z" }, child: [] }] })(e);
}
function ao(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M3 4H21V6H3V4ZM7 19H21V21H7V19ZM3 14H21V16H3V14ZM7 9H21V11H7V9Z" }, child: [] }] })(e);
}
function so(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M8 11H12.5C13.8807 11 15 9.88071 15 8.5C15 7.11929 13.8807 6 12.5 6H8V11ZM18 15.5C18 17.9853 15.9853 20 13.5 20H6V4H12.5C14.9853 4 17 6.01472 17 8.5C17 9.70431 16.5269 10.7981 15.7564 11.6058C17.0979 12.3847 18 13.837 18 15.5ZM8 13V18H13.5C14.8807 18 16 16.8807 16 15.5C16 14.1193 14.8807 13 13.5 13H8Z" }, child: [] }] })(e);
}
function uo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M3.41436 5.99995L5.70726 3.70706L4.29304 2.29285L0.585938 5.99995L4.29304 9.70706L5.70726 8.29285L3.41436 5.99995ZM9.58594 5.99995L7.29304 3.70706L8.70726 2.29285L12.4144 5.99995L8.70726 9.70706L7.29304 8.29285L9.58594 5.99995ZM14.0002 2.99995H21.0002C21.5524 2.99995 22.0002 3.44767 22.0002 3.99995V20C22.0002 20.5522 21.5524 21 21.0002 21H3.00015C2.44787 21 2.00015 20.5522 2.00015 20V12H4.00015V19H20.0002V4.99995H14.0002V2.99995Z" }, child: [] }] })(e);
}
function $e(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M5.55397 22H3.3999L10.9999 3H12.9999L20.5999 22H18.4458L16.0458 16H7.95397L5.55397 22ZM8.75397 14H15.2458L11.9999 5.88517L8.75397 14Z" }, child: [] }] })(e);
}
function ce(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M13 20H11V13H4V20H2V4H4V11H11V4H13V20ZM21.0005 8V20H19.0005L19 10.204L17 10.74V8.67L19.5005 8H21.0005Z" }, child: [] }] })(e);
}
function ae(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M4 4V11H11V4H13V20H11V13H4V20H2V4H4ZM18.5 8C20.5711 8 22.25 9.67893 22.25 11.75C22.25 12.6074 21.9623 13.3976 21.4781 14.0292L21.3302 14.2102L18.0343 18H22V20H15L14.9993 18.444L19.8207 12.8981C20.0881 12.5908 20.25 12.1893 20.25 11.75C20.25 10.7835 19.4665 10 18.5 10C17.5818 10 16.8288 10.7071 16.7558 11.6065L16.75 11.75H14.75C14.75 9.67893 16.4289 8 18.5 8Z" }, child: [] }] })(e);
}
function se(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M22 8L21.9984 10L19.4934 12.883C21.0823 13.3184 22.25 14.7728 22.25 16.5C22.25 18.5711 20.5711 20.25 18.5 20.25C16.674 20.25 15.1528 18.9449 14.8184 17.2166L16.7821 16.8352C16.9384 17.6413 17.6481 18.25 18.5 18.25C19.4665 18.25 20.25 17.4665 20.25 16.5C20.25 15.5335 19.4665 14.75 18.5 14.75C18.214 14.75 17.944 14.8186 17.7056 14.9403L16.3992 13.3932L19.3484 10H15V8H22ZM4 4V11H11V4H13V20H11V13H4V20H2V4H4Z" }, child: [] }] })(e);
}
function kt(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M13 20H11V13H4V20H2V4H4V11H11V4H13V20ZM22 8V16H23.5V18H22V20H20V18H14.5V16.66L19.5 8H22ZM20 11.133L17.19 16H20V11.133Z" }, child: [] }] })(e);
}
function wt(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M22 8V10H17.6769L17.2126 12.6358C17.5435 12.5472 17.8912 12.5 18.25 12.5C20.4591 12.5 22.25 14.2909 22.25 16.5C22.25 18.7091 20.4591 20.5 18.25 20.5C16.4233 20.5 14.8827 19.2756 14.4039 17.6027L16.3271 17.0519C16.5667 17.8881 17.3369 18.5 18.25 18.5C19.3546 18.5 20.25 17.6046 20.25 16.5C20.25 15.3954 19.3546 14.5 18.25 14.5C17.6194 14.5 17.057 14.7918 16.6904 15.2478L14.8803 14.3439L16 8H22ZM4 4V11H11V4H13V20H11V13H4V20H2V4H4Z" }, child: [] }] })(e);
}
function vt(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M21.097 8L18.499 12.5C20.7091 12.5 22.5 14.2909 22.5 16.5C22.5 18.7091 20.7091 20.5 18.5 20.5C16.2909 20.5 14.5 18.7091 14.5 16.5C14.5 15.7636 14.699 15.0737 15.0461 14.4811L18.788 8H21.097ZM4 4V11H11V4H13V20H11V13H4V20H2V4H4ZM18.5 14.5C17.3954 14.5 16.5 15.3954 16.5 16.5C16.5 17.6046 17.3954 18.5 18.5 18.5C19.6046 18.5 20.5 17.6046 20.5 16.5C20.5 15.3954 19.6046 14.5 18.5 14.5Z" }, child: [] }] })(e);
}
function mo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM3 12.5L7 9V16L3 12.5Z" }, child: [] }] })(e);
}
function ho(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM7 12.5L3 16V9L7 12.5Z" }, child: [] }] })(e);
}
function Ke(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M8 5H11V19H8V21H16V19H13V5H16V3H8V5ZM2 7C1.44772 7 1 7.44772 1 8V16C1 16.5523 1.44772 17 2 17H8V15H3V9H8V7H2ZM16 9H21V15H16V17H22C22.5523 17 23 16.5523 23 16V8C23 7.44772 22.5523 7 22 7H16V9Z" }, child: [] }] })(e);
}
function go(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M15 20H7V18H9.92661L12.0425 6H9V4H17V6H14.0734L11.9575 18H15V20Z" }, child: [] }] })(e);
}
function fo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M17 17H22V19H19V22H17V17ZM7 7H2V5H5V2H7V7ZM18.364 15.5355L16.9497 14.1213L18.364 12.7071C20.3166 10.7545 20.3166 7.58866 18.364 5.63604C16.4113 3.68342 13.2455 3.68342 11.2929 5.63604L9.87868 7.05025L8.46447 5.63604L9.87868 4.22183C12.6123 1.48816 17.0445 1.48816 19.7782 4.22183C22.5118 6.9555 22.5118 11.3877 19.7782 14.1213L18.364 15.5355ZM15.5355 18.364L14.1213 19.7782C11.3877 22.5118 6.9555 22.5118 4.22183 19.7782C1.48816 17.0445 1.48816 12.6123 4.22183 9.87868L5.63604 8.46447L7.05025 9.87868L5.63604 11.2929C3.68342 13.2455 3.68342 16.4113 5.63604 18.364C7.58866 20.3166 10.7545 20.3166 12.7071 18.364L14.1213 16.9497L15.5355 18.364ZM14.8284 7.75736L16.2426 9.17157L9.17157 16.2426L7.75736 14.8284L14.8284 7.75736Z" }, child: [] }] })(e);
}
function Ht(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M18.3638 15.5355L16.9496 14.1213L18.3638 12.7071C20.3164 10.7545 20.3164 7.58866 18.3638 5.63604C16.4112 3.68341 13.2453 3.68341 11.2927 5.63604L9.87849 7.05025L8.46428 5.63604L9.87849 4.22182C12.6122 1.48815 17.0443 1.48815 19.778 4.22182C22.5117 6.95549 22.5117 11.3876 19.778 14.1213L18.3638 15.5355ZM15.5353 18.364L14.1211 19.7782C11.3875 22.5118 6.95531 22.5118 4.22164 19.7782C1.48797 17.0445 1.48797 12.6123 4.22164 9.87868L5.63585 8.46446L7.05007 9.87868L5.63585 11.2929C3.68323 13.2455 3.68323 16.4113 5.63585 18.364C7.58847 20.3166 10.7543 20.3166 12.7069 18.364L14.1211 16.9497L15.5353 18.364ZM14.8282 7.75736L16.2425 9.17157L9.17139 16.2426L7.75717 14.8284L14.8282 7.75736Z" }, child: [] }] })(e);
}
function Mt(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M8.00008 6V9H5.00008V6H8.00008ZM3.00008 4V11H10.0001V4H3.00008ZM13.0001 4H21.0001V6H13.0001V4ZM13.0001 11H21.0001V13H13.0001V11ZM13.0001 18H21.0001V20H13.0001V18ZM10.7072 16.2071L9.29297 14.7929L6.00008 18.0858L4.20718 16.2929L2.79297 17.7071L6.00008 20.9142L10.7072 16.2071Z" }, child: [] }] })(e);
}
function yt(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M8 4H21V6H8V4ZM5 3V6H6V7H3V6H4V4H3V3H5ZM3 14V11.5H5V11H3V10H6V12.5H4V13H6V14H3ZM5 19.5H3V18.5H5V18H3V17H6V21H3V20H5V19.5ZM8 11H21V13H8V11ZM8 18H21V20H8V18Z" }, child: [] }] })(e);
}
function xt(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M8 4H21V6H8V4ZM4.5 6.5C3.67157 6.5 3 5.82843 3 5C3 4.17157 3.67157 3.5 4.5 3.5C5.32843 3.5 6 4.17157 6 5C6 5.82843 5.32843 6.5 4.5 6.5ZM4.5 13.5C3.67157 13.5 3 12.8284 3 12C3 11.1716 3.67157 10.5 4.5 10.5C5.32843 10.5 6 11.1716 6 12C6 12.8284 5.32843 13.5 4.5 13.5ZM4.5 20.4C3.67157 20.4 3 19.7284 3 18.9C3 18.0716 3.67157 17.4 4.5 17.4C5.32843 17.4 6 18.0716 6 18.9C6 19.7284 5.32843 20.4 4.5 20.4ZM8 11H21V13H8V11ZM8 18H21V20H8V18Z" }, child: [] }] })(e);
}
function bo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M20 3C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3H20ZM11 5H5V10.999H7V9L10 12L7 15V13H5V19H11V17H13V19H19V13H17V15L14 12L17 9V10.999H19V5H13V7H11V5ZM13 13V15H11V13H13ZM13 9V11H11V9H13Z" }, child: [] }] })(e);
}
function Co(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M21 20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3H20C20.5523 3 21 3.44772 21 4V20ZM19 11V5H13.001V7H15L12 10L9 7H11V5H5V11H7V13H5V19H11V17H9L12 14L15 17H13.001V19H19V13H17V11H19ZM11 13H9V11H11V13ZM15 13H13V11H15V13Z" }, child: [] }] })(e);
}
function Vt(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M21 4H3V6H21V4ZM21 11H8V13H21V11ZM21 18H8V20H21V18ZM5 11H3V20H5V11Z" }, child: [] }] })(e);
}
function po(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M17.1538 14C17.3846 14.5161 17.5 15.0893 17.5 15.7196C17.5 17.0625 16.9762 18.1116 15.9286 18.867C14.8809 19.6223 13.4335 20 11.5862 20C9.94674 20 8.32335 19.6185 6.71592 18.8555V16.6009C8.23538 17.4783 9.7908 17.917 11.3822 17.917C13.9333 17.917 15.2128 17.1846 15.2208 15.7196C15.2208 15.0939 15.0049 14.5598 14.5731 14.1173C14.5339 14.0772 14.4939 14.0381 14.4531 14H3V12H21V14H17.1538ZM13.076 11H7.62908C7.4566 10.8433 7.29616 10.6692 7.14776 10.4778C6.71592 9.92084 6.5 9.24559 6.5 8.45207C6.5 7.21602 6.96583 6.165 7.89749 5.299C8.82916 4.43299 10.2706 4 12.2219 4C13.6934 4 15.1009 4.32808 16.4444 4.98426V7.13591C15.2448 6.44921 13.9293 6.10587 12.4978 6.10587C10.0187 6.10587 8.77917 6.88793 8.77917 8.45207C8.77917 8.87172 8.99709 9.23796 9.43293 9.55079C9.86878 9.86362 10.4066 10.1135 11.0463 10.3004C11.6665 10.4816 12.3431 10.7148 13.076 11H13.076Z" }, child: [] }] })(e);
}
function ko(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M13 10V14H19V10H13ZM11 10H5V14H11V10ZM13 19H19V16H13V19ZM11 19V16H5V19H11ZM13 5V8H19V5H13ZM11 5H5V8H11V5ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3Z" }, child: [] }] })(e);
}
function Ze(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M13 6V21H11V6H5V4H19V6H13Z" }, child: [] }] })(e);
}
function wo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M8 3V12C8 14.2091 9.79086 16 12 16C14.2091 16 16 14.2091 16 12V3H18V12C18 15.3137 15.3137 18 12 18C8.68629 18 6 15.3137 6 12V3H8ZM4 20H20V22H4V20Z" }, child: [] }] })(e);
}
function vo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M2 3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44495 22 3.9934V20.0066C22 20.5552 21.5447 21 21.0082 21H2.9918C2.44405 21 2 20.5551 2 20.0066V3.9934ZM8 5V19H16V5H8ZM4 5V7H6V5H4ZM18 5V7H20V5H18ZM4 9V11H6V9H4ZM18 9V11H20V9H18ZM4 13V15H6V13H4ZM18 13V15H20V13H18ZM4 17V19H6V17H4ZM18 17V19H20V17H18Z" }, child: [] }] })(e);
}
function Bt(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M5 11.1005L7 9.1005L12.5 14.6005L16 11.1005L19 14.1005V5H5V11.1005ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10Z" }, child: [] }] })(e);
}
function Ho(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M21 15V18H24V20H21V23H19V20H16V18H19V15H21ZM21.0082 3C21.556 3 22 3.44495 22 3.9934L22.0007 13.3417C21.3749 13.1204 20.7015 13 20 13V5H4L4.001 19L13.2929 9.70715C13.6528 9.34604 14.22 9.31823 14.6123 9.62322L14.7065 9.70772L18.2521 13.2586C15.791 14.0069 14 16.2943 14 19C14 19.7015 14.1204 20.3749 14.3417 21.0007L2.9918 21C2.44405 21 2 20.5551 2 20.0066V3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082ZM8 7C9.10457 7 10 7.89543 10 9C10 10.1046 9.10457 11 8 11C6.89543 11 6 10.1046 6 9C6 7.89543 6.89543 7 8 7Z" }, child: [] }] })(e);
}
function Mo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M20 3C20.5523 3 21 3.44772 21 4V5.757L19 7.757V5H5V13.1L9 9.1005L13.328 13.429L12.0012 14.7562L11.995 18.995L16.2414 19.0012L17.571 17.671L18.8995 19H19V16.242L21 14.242V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3H20ZM21.7782 7.80761L23.1924 9.22183L15.4142 17L13.9979 16.9979L14 15.5858L21.7782 7.80761ZM15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7Z" }, child: [] }] })(e);
}
function Tt(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M22 18V20H2V18H22ZM2 3.5L10 8.5L2 13.5V3.5ZM22 11V13H12V11H22ZM22 4V6H12V4H22Z" }, child: [] }] })(e);
}
function yo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M3 3.9934C3 3.44476 3.44495 3 3.9934 3H20.0066C20.5552 3 21 3.44495 21 3.9934V20.0066C21 20.5552 20.5551 21 20.0066 21H3.9934C3.44476 21 3 20.5551 3 20.0066V3.9934ZM10.6219 8.41459C10.5562 8.37078 10.479 8.34741 10.4 8.34741C10.1791 8.34741 10 8.52649 10 8.74741V15.2526C10 15.3316 10.0234 15.4088 10.0672 15.4745C10.1897 15.6583 10.4381 15.708 10.6219 15.5854L15.5008 12.3328C15.5447 12.3035 15.5824 12.2658 15.6117 12.2219C15.7343 12.0381 15.6846 11.7897 15.5008 11.6672L10.6219 8.41459Z" }, child: [] }] })(e);
}
function St(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M2 16.0001H5.88889L11.1834 20.3319C11.2727 20.405 11.3846 20.4449 11.5 20.4449C11.7761 20.4449 12 20.2211 12 19.9449V4.05519C12 3.93977 11.9601 3.8279 11.887 3.73857C11.7121 3.52485 11.3971 3.49335 11.1834 3.66821L5.88889 8.00007H2C1.44772 8.00007 1 8.44778 1 9.00007V15.0001C1 15.5524 1.44772 16.0001 2 16.0001ZM23 12C23 15.292 21.5539 18.2463 19.2622 20.2622L17.8445 18.8444C19.7758 17.1937 21 14.7398 21 12C21 9.26016 19.7758 6.80629 17.8445 5.15557L19.2622 3.73779C21.5539 5.75368 23 8.70795 23 12ZM18 12C18 10.0883 17.106 8.38548 15.7133 7.28673L14.2842 8.71584C15.3213 9.43855 16 10.64 16 12C16 13.36 15.3213 14.5614 14.2842 15.2841L15.7133 16.7132C17.106 15.6145 18 13.9116 18 12Z" }, child: [] }] })(e);
}
function xo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z" }, child: [] }] })(e);
}
function Vo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z" }, child: [] }] })(e);
}
function Bo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM18 8H6V20H18V8ZM9 4V6H15V4H9Z" }, child: [] }] })(e);
}
function To(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM9 11V17H11V11H9ZM13 11V17H15V11H13ZM9 4V6H15V4H9Z" }, child: [] }] })(e);
}
function So(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M4 19H20V12H22V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V12H4V19ZM14 9H19L12 16L5 9H10V3H14V9Z" }, child: [] }] })(e);
}
function Lo(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M10 6V8H5V19H16V14H18V20C18 20.5523 17.5523 21 17 21H4C3.44772 21 3 20.5523 3 20V7C3 6.44772 3.44772 6 4 6H10ZM21 3V12L17.206 8.207L11.2071 14.2071L9.79289 12.7929L15.792 6.793L12 3H21Z" }, child: [] }] })(e);
}
function _o(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M5 10C3.9 10 3 10.9 3 12C3 13.1 3.9 14 5 14C6.1 14 7 13.1 7 12C7 10.9 6.1 10 5 10ZM19 10C17.9 10 17 10.9 17 12C17 13.1 17.9 14 19 14C20.1 14 21 13.1 21 12C21 10.9 20.1 10 19 10ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10Z" }, child: [] }] })(e);
}
function Ro(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM8 13C8 15.2091 9.79086 17 12 17C14.2091 17 16 15.2091 16 13H8ZM8 11C8.82843 11 9.5 10.3284 9.5 9.5C9.5 8.67157 8.82843 8 8 8C7.17157 8 6.5 8.67157 6.5 9.5C6.5 10.3284 7.17157 11 8 11ZM16 11C16.8284 11 17.5 10.3284 17.5 9.5C17.5 8.67157 16.8284 8 16 8C15.1716 8 14.5 8.67157 14.5 9.5C14.5 10.3284 15.1716 11 16 11Z" }, child: [] }] })(e);
}
function Xe(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "currentColor" }, child: [{ tag: "path", attr: { d: "M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM8 13H16C16 15.2091 14.2091 17 12 17C9.79086 17 8 15.2091 8 13ZM8 11C7.17157 11 6.5 10.3284 6.5 9.5C6.5 8.67157 7.17157 8 8 8C8.82843 8 9.5 8.67157 9.5 9.5C9.5 10.3284 8.82843 11 8 11ZM16 11C15.1716 11 14.5 10.3284 14.5 9.5C14.5 8.67157 15.1716 8 16 8C16.8284 8 17.5 8.67157 17.5 9.5C17.5 10.3284 16.8284 11 16 11Z" }, child: [] }] })(e);
}
let oe;
async function Eo() {
  return oe || (oe = (async () => {
    const [e, t] = await Promise.all([
      import("emoji-mart"),
      // use a dynamic import to encourage bundle-splitting
      // and a smaller initial client bundle size
      import("@emoji-mart/data")
    ]), n = "default" in e ? e.default : e, o = "default" in t ? t.default : t;
    return await n.init({ data: o }), { emojiMart: n, emojiData: o };
  })(), oe);
}
function Io(e) {
  const t = N(null), n = N(null);
  return n.current && n.current.update(e), x(() => ((async () => {
    const { emojiMart: o } = await Eo();
    n.current = new o.Picker({ ...e, ref: t });
  })(), () => {
    n.current = null;
  }), []), P.createElement("div", { ref: t });
}
const Ye = (e) => {
  const [t, n] = w(!1), o = p(), r = D();
  return /* @__PURE__ */ v(o.Generic.Popover.Root, { opened: t, children: [
    /* @__PURE__ */ i(o.Generic.Popover.Trigger, { children: /* @__PURE__ */ i(
      "div",
      {
        onClick: (l) => {
          l.preventDefault(), l.stopPropagation(), n(!t);
        },
        style: {
          display: "flex",
          justifyContent: "center",
          alignItems: "center"
        },
        children: e.children
      }
    ) }),
    /* @__PURE__ */ i(o.Generic.Popover.Content, { variant: "panel-popover", children: /* @__PURE__ */ i(
      Io,
      {
        perLine: 7,
        onClickOutside: () => n(!1),
        onEmojiSelect: (l) => {
          e.onEmojiSelect(l), n(!1);
        },
        theme: r == null ? void 0 : r.colorSchemePreference
      }
    ) })
  ] });
};
function No(e, t) {
  return De(e, [t]).get(t);
}
function De(e, t) {
  const n = e.comments;
  if (!n)
    throw new Error("Comments plugin not found");
  const o = n.userStore, r = f(() => {
    const s = /* @__PURE__ */ new Map();
    for (const d of t) {
      const a = o.getUser(d);
      a && s.set(d, a);
    }
    return s;
  }, [o, t]), l = y(() => ({
    current: r()
  }), [r]), c = f(
    (s) => {
      const d = o.subscribe((a) => {
        l.current = r(), s();
      });
      return o.loadUsers(t), d;
    },
    [o, r, t, l]
  );
  return Se(c, () => l.current);
}
const Po = (e) => {
  const t = p(), n = M(), o = C();
  if (!o.comments)
    throw new Error(
      "ReactionBadge must be used inside a BlockNote editor with comments enabled"
    );
  const r = e.comment.reactions.find(
    (d) => d.emoji === e.emoji
  );
  if (!r)
    throw new Error(
      "Trying to render reaction badge for non-existing reaction"
    );
  const [l, c] = w([]), s = De(o, l);
  return /* @__PURE__ */ i(
    t.Generic.Badge.Root,
    {
      className: _("bn-badge", "bn-comment-reaction"),
      text: r.userIds.length.toString(),
      icon: r.emoji,
      isSelected: o.comments.threadStore.auth.canDeleteReaction(
        e.comment,
        r.emoji
      ),
      onClick: () => e.onReactionSelect(r.emoji),
      onMouseEnter: () => c(r.userIds),
      mainTooltip: n.comments.reactions.reacted_by,
      secondaryTooltip: `${Array.from(s.values()).map((d) => d.username).join(`
`)}`
    },
    r.emoji
  );
}, Zo = ({
  comment: e,
  thread: t,
  showResolveButton: n
}) => {
  const o = M(), r = fe(
    {
      initialContent: e.body,
      trailingBlock: !1,
      dictionary: {
        ...o,
        placeholders: {
          emptyDocument: o.placeholders.edit_comment
        }
      },
      schema: Ne,
      sideMenuDetection: "editor"
    },
    [e.body]
  ), l = p(), [c, s] = w(!1), d = C();
  if (!d.comments)
    throw new Error("Comments plugin not found");
  const a = d.comments.threadStore, u = f(() => {
    s(!0);
  }, []), h = f(() => {
    r.replaceBlocks(r.document, e.body), s(!1);
  }, [r, e.body]), m = f(
    async (R) => {
      await a.updateComment({
        commentId: e.id,
        comment: {
          body: r.document
        },
        threadId: t.id
      }), s(!1);
    },
    [e, t.id, r, a]
  ), g = f(async () => {
    await a.deleteComment({
      commentId: e.id,
      threadId: t.id
    });
  }, [e, t.id, a]), H = f(
    async (R) => {
      a.auth.canAddReaction(e, R) ? await a.addReaction({
        threadId: t.id,
        commentId: e.id,
        emoji: R
      }) : a.auth.canDeleteReaction(e, R) && await a.deleteReaction({
        threadId: t.id,
        commentId: e.id,
        emoji: R
      });
    },
    [a, e, t.id]
  ), b = f(async () => {
    await a.resolveThread({
      threadId: t.id
    });
  }, [t.id, a]), B = f(async () => {
    await a.unresolveThread({
      threadId: t.id
    });
  }, [t.id, a]), V = No(d, e.userId);
  if (!e.body)
    return null;
  let T;
  const I = a.auth.canAddReaction(e), z = a.auth.canDeleteComment(e), j = a.auth.canUpdateComment(e), O = n && (t.resolved ? a.auth.canUnresolveThread(t) : a.auth.canResolveThread(t));
  c || (T = /* @__PURE__ */ v(
    l.Generic.Toolbar.Root,
    {
      className: _("bn-action-toolbar", "bn-comment-actions"),
      variant: "action-toolbar",
      children: [
        I && /* @__PURE__ */ i(
          Ye,
          {
            onEmojiSelect: (R) => H(R.native),
            children: /* @__PURE__ */ i(
              l.Generic.Toolbar.Button,
              {
                mainTooltip: o.comments.actions.add_reaction,
                variant: "compact",
                children: /* @__PURE__ */ i(Xe, { size: 16 })
              },
              "add-reaction"
            )
          }
        ),
        O && (t.resolved ? /* @__PURE__ */ i(
          l.Generic.Toolbar.Button,
          {
            mainTooltip: "Re-open",
            variant: "compact",
            onClick: B,
            children: /* @__PURE__ */ i(no, { size: 16 })
          },
          "reopen"
        ) : /* @__PURE__ */ i(
          l.Generic.Toolbar.Button,
          {
            mainTooltip: o.comments.actions.resolve,
            variant: "compact",
            onClick: b,
            children: /* @__PURE__ */ i(Vo, { size: 16 })
          },
          "resolve"
        )),
        (z || j) && /* @__PURE__ */ v(l.Generic.Menu.Root, { position: "bottom-start", children: [
          /* @__PURE__ */ i(l.Generic.Menu.Trigger, { children: /* @__PURE__ */ i(
            l.Generic.Toolbar.Button,
            {
              mainTooltip: o.comments.actions.more_actions,
              variant: "compact",
              children: /* @__PURE__ */ i(_o, { size: 16 })
            },
            "more-actions"
          ) }),
          /* @__PURE__ */ v(l.Generic.Menu.Dropdown, { className: "bn-menu-dropdown", children: [
            j && /* @__PURE__ */ i(
              l.Generic.Menu.Item,
              {
                icon: /* @__PURE__ */ i(oo, {}),
                onClick: u,
                children: o.comments.actions.edit_comment
              },
              "edit-comment"
            ),
            z && /* @__PURE__ */ i(
              l.Generic.Menu.Item,
              {
                icon: /* @__PURE__ */ i(To, {}),
                onClick: g,
                children: o.comments.actions.delete_comment
              },
              "delete-comment"
            )
          ] })
        ] })
      ]
    }
  ));
  const q = e.createdAt.toLocaleDateString(void 0, {
    month: "short",
    day: "numeric"
  });
  if (!e.body)
    throw new Error("soft deletes are not yet supported");
  return /* @__PURE__ */ i(
    l.Comments.Comment,
    {
      authorInfo: V ?? "loading",
      timeString: q,
      edited: e.updatedAt.getTime() !== e.createdAt.getTime(),
      showActions: "hover",
      actions: T,
      className: "bn-thread-comment",
      children: /* @__PURE__ */ i(
        Ie,
        {
          autoFocus: c,
          editor: r,
          editable: c,
          actions: e.reactions.length > 0 || c ? ({ isEmpty: R }) => /* @__PURE__ */ v(S, { children: [
            e.reactions.length > 0 && !c && /* @__PURE__ */ v(
              l.Generic.Badge.Group,
              {
                className: _(
                  "bn-badge-group",
                  "bn-comment-reactions"
                ),
                children: [
                  e.reactions.map((F) => /* @__PURE__ */ i(
                    Po,
                    {
                      comment: e,
                      emoji: F.emoji,
                      onReactionSelect: H
                    },
                    F.emoji
                  )),
                  /* @__PURE__ */ i(
                    Ye,
                    {
                      onEmojiSelect: (F) => H(F.native),
                      children: /* @__PURE__ */ i(
                        l.Generic.Badge.Root,
                        {
                          className: _(
                            "bn-badge",
                            "bn-comment-add-reaction"
                          ),
                          text: "+",
                          icon: /* @__PURE__ */ i(Xe, { size: 16 }),
                          mainTooltip: o.comments.actions.add_reaction
                        }
                      )
                    }
                  )
                ]
              }
            ),
            c && /* @__PURE__ */ v(
              l.Generic.Toolbar.Root,
              {
                variant: "action-toolbar",
                className: _(
                  "bn-action-toolbar",
                  "bn-comment-actions"
                ),
                children: [
                  /* @__PURE__ */ i(
                    l.Generic.Toolbar.Button,
                    {
                      mainTooltip: o.comments.save_button_text,
                      variant: "compact",
                      onClick: m,
                      isDisabled: R,
                      children: o.comments.save_button_text
                    }
                  ),
                  /* @__PURE__ */ i(
                    l.Generic.Toolbar.Button,
                    {
                      className: "bn-button",
                      mainTooltip: o.comments.cancel_button_text,
                      variant: "compact",
                      onClick: h,
                      children: o.comments.cancel_button_text
                    }
                  )
                ]
              }
            )
          ] }) : void 0
        }
      )
    }
  );
}, Do = ({
  thread: e,
  maxCommentsBeforeCollapse: t
}) => {
  const n = p(), o = M(), r = C(), l = De(r, e.resolvedBy ? [e.resolvedBy] : []), c = e.comments.map((s, d) => /* @__PURE__ */ i(
    Zo,
    {
      thread: e,
      comment: s,
      showResolveButton: d === 0
    },
    s.id
  ));
  if (e.resolved && e.resolvedUpdatedAt && e.resolvedBy) {
    if (!l.get(e.resolvedBy))
      throw new Error(
        `User ${e.resolvedBy} resolved thread ${e.id}, but their data could not be found.`
      );
    const d = e.comments.findLastIndex(
      (a) => e.resolvedUpdatedAt.getTime() > a.createdAt.getTime()
    ) + 1;
    c.splice(
      d,
      0,
      /* @__PURE__ */ i(
        n.Comments.Comment,
        {
          className: "bn-thread-comment",
          authorInfo: e.resolvedBy && l.get(e.resolvedBy) || "loading",
          timeString: e.resolvedUpdatedAt.toLocaleDateString(void 0, {
            month: "short",
            day: "numeric"
          }),
          edited: !1,
          showActions: !1,
          children: /* @__PURE__ */ i("div", { className: "bn-resolved-text", children: o.comments.sidebar.marked_as_resolved })
        },
        "resolved-comment"
      )
    );
  }
  return t && c.length > t && c.splice(
    1,
    c.length - 2,
    /* @__PURE__ */ i(
      n.Comments.ExpandSectionsPrompt,
      {
        className: "bn-thread-expand-prompt",
        children: o.comments.sidebar.more_replies(e.comments.length - 2)
      },
      "expand-prompt"
    )
  ), c;
}, Lt = ({
  thread: e,
  selected: t,
  referenceText: n,
  maxCommentsBeforeCollapse: o,
  onFocus: r,
  onBlur: l,
  tabIndex: c
}) => {
  const s = p(), d = M(), u = C().comments;
  if (!u)
    throw new Error("Comments plugin not found");
  const h = fe({
    trailingBlock: !1,
    dictionary: {
      ...d,
      placeholders: {
        emptyDocument: d.placeholders.comment_reply
      }
    },
    schema: Ne,
    sideMenuDetection: "editor"
  }), m = f(async () => {
    await u.threadStore.addComment({
      comment: {
        body: h.document
      },
      threadId: e.id
    }), h.removeBlocks(h.document);
  }, [u, h, e.id]);
  return /* @__PURE__ */ v(
    s.Comments.Card,
    {
      className: "bn-thread",
      headerText: n,
      onFocus: r,
      onBlur: l,
      selected: t,
      tabIndex: c,
      children: [
        /* @__PURE__ */ i(s.Comments.CardSection, { className: "bn-thread-comments", children: /* @__PURE__ */ i(
          Do,
          {
            thread: e,
            maxCommentsBeforeCollapse: t ? void 0 : o || 5
          }
        ) }),
        t && /* @__PURE__ */ i(s.Comments.CardSection, { className: "bn-thread-composer", children: /* @__PURE__ */ i(
          Ie,
          {
            autoFocus: !1,
            editable: !0,
            editor: h,
            actions: ({ isEmpty: g }) => g ? null : /* @__PURE__ */ i(
              s.Generic.Toolbar.Root,
              {
                variant: "action-toolbar",
                className: _(
                  "bn-action-toolbar",
                  "bn-comment-actions"
                ),
                children: /* @__PURE__ */ i(
                  s.Generic.Toolbar.Button,
                  {
                    mainTooltip: d.comments.save_button_text,
                    variant: "compact",
                    isDisabled: g,
                    onClick: m,
                    children: d.comments.save_button_text
                  }
                )
              }
            )
          }
        ) })
      ]
    }
  );
};
function _t(e) {
  const t = e.comments;
  if (!t)
    throw new Error("Comments plugin not found");
  const n = t.threadStore, o = N();
  o.current || (o.current = n.getThreads());
  const r = f(
    (l) => n.subscribe((c) => {
      o.current = c, l();
    }),
    [n]
  );
  return Se(r, () => o.current);
}
const Oo = (e) => {
  const t = C();
  if (!t.comments)
    throw new Error(
      "FloatingComposerController can only be used when BlockNote editor has enabled comments"
    );
  const n = Z(
    t.comments.onUpdate.bind(t.comments)
  ), { isMounted: o, ref: r, style: l, getFloatingProps: c, setReference: s } = G(!!(n != null && n.selectedThreadId), null, 5e3, {
    placement: "bottom",
    middleware: [A(10), ue(), W()],
    onOpenChange: (h) => {
      var m;
      h || ((m = t.comments) == null || m.selectThread(void 0), t.focus());
    },
    ...e.floatingOptions
  }), d = f(() => {
    var m;
    if (!(n != null && n.selectedThreadId))
      return;
    const h = (m = t.domElement) == null ? void 0 : m.querySelector(
      `[data-bn-thread-id="${n == null ? void 0 : n.selectedThreadId}"]`
    );
    h && s(h);
  }, [s, t, n == null ? void 0 : n.selectedThreadId]);
  x(() => {
    if (n != null && n.selectedThreadId)
      return t.onChange(() => {
        d();
      });
  }, [t, d, n == null ? void 0 : n.selectedThreadId]), $t(d, [d]);
  const a = _t(t);
  if (!o || !n || !n.selectedThreadId)
    return null;
  const u = e.floatingThread || Lt;
  return /* @__PURE__ */ i("div", { ref: r, style: l, ...c(), children: /* @__PURE__ */ i(
    u,
    {
      thread: a.get(n.selectedThreadId),
      selected: !0
    }
  ) });
}, Fo = (e) => {
  const t = p(), n = M(), { block: o } = e, r = C(), [l, c] = w(""), s = f(
    (u) => {
      c(u.currentTarget.value);
    },
    []
  ), d = f(
    (u) => {
      u.key === "Enter" && (u.preventDefault(), r.updateBlock(o, {
        props: {
          name: ze(l),
          url: l
        }
      }));
    },
    [r, o, l]
  ), a = f(() => {
    r.updateBlock(o, {
      props: {
        name: ze(l),
        url: l
      }
    });
  }, [r, o, l]);
  return /* @__PURE__ */ v(t.FilePanel.TabPanel, { className: "bn-tab-panel", children: [
    /* @__PURE__ */ i(
      t.FilePanel.TextInput,
      {
        className: "bn-text-input",
        placeholder: n.file_panel.embed.url_placeholder,
        value: l,
        onChange: s,
        onKeyDown: d,
        "data-test": "embed-input"
      }
    ),
    /* @__PURE__ */ i(
      t.FilePanel.Button,
      {
        className: "bn-button",
        onClick: a,
        "data-test": "embed-input-button",
        children: n.file_panel.embed.embed_button[o.type] || n.file_panel.embed.embed_button.file
      }
    )
  ] });
}, Ao = (e) => {
  var h;
  const t = p(), n = M(), { block: o, setLoading: r } = e, l = C(), [c, s] = w(!1);
  x(() => {
    c && setTimeout(() => {
      s(!1);
    }, 3e3);
  }, [c]);
  const d = f(
    (m) => {
      if (m === null)
        return;
      async function g(H) {
        if (r(!0), l.uploadFile !== void 0)
          try {
            let b = await l.uploadFile(H, o.id);
            typeof b == "string" && (b = {
              props: {
                name: H.name,
                url: b
              }
            }), l.updateBlock(o, b);
          } catch {
            s(!0);
          } finally {
            r(!1);
          }
      }
      g(m);
    },
    [o, l, r]
  ), a = l.schema.blockSchema[o.type], u = a.isFileBlock && ((h = a.fileBlockAccept) != null && h.length) ? a.fileBlockAccept.join(",") : "*/*";
  return /* @__PURE__ */ v(t.FilePanel.TabPanel, { className: "bn-tab-panel", children: [
    /* @__PURE__ */ i(
      t.FilePanel.FileInput,
      {
        className: "bn-file-input",
        "data-test": "upload-input",
        accept: u,
        placeholder: n.file_panel.upload.file_placeholder[o.type] || n.file_panel.upload.file_placeholder.file,
        value: null,
        onChange: d
      }
    ),
    c && /* @__PURE__ */ i("div", { className: "bn-error-text", children: n.file_panel.upload.upload_error })
  ] });
}, Rt = (e) => {
  const t = p(), n = M(), o = C(), [r, l] = w(!1), c = e.tabs ?? [
    ...o.uploadFile !== void 0 ? [
      {
        name: n.file_panel.upload.title,
        tabPanel: /* @__PURE__ */ i(Ao, { block: e.block, setLoading: l })
      }
    ] : [],
    {
      name: n.file_panel.embed.title,
      tabPanel: /* @__PURE__ */ i(Fo, { block: e.block })
    }
  ], [s, d] = w(
    e.defaultOpenTab || c[0].name
  );
  return /* @__PURE__ */ i(
    t.FilePanel.Root,
    {
      className: "bn-panel",
      defaultOpenTab: s,
      openTab: s,
      setOpenTab: d,
      tabs: c,
      loading: r
    }
  );
}, Go = (e) => {
  const t = C();
  if (!t.filePanel)
    throw new Error(
      "FileToolbarController can only be used when BlockNote editor schema contains file block"
    );
  const n = Z(
    t.filePanel.onUpdate.bind(t.filePanel)
  ), { isMounted: o, ref: r, style: l, getFloatingProps: c } = G(
    (n == null ? void 0 : n.show) || !1,
    (n == null ? void 0 : n.referencePos) || null,
    5e3,
    {
      placement: "bottom",
      middleware: [A(10), W()],
      onOpenChange: (h) => {
        h || (t.filePanel.closeMenu(), t.focus());
      },
      ...e.floatingOptions
    }
  );
  if (!o || !n)
    return null;
  const { show: s, referencePos: d, ...a } = n, u = e.filePanel || Rt;
  return /* @__PURE__ */ i("div", { ref: r, style: l, ...c(), children: /* @__PURE__ */ i(u, { ...a }) });
};
function Uo(e, t) {
  if (t == null)
    return !1;
  if ("composedPath" in e)
    return e.composedPath().includes(t);
  const n = e;
  return n.target != null && t.contains(n.target);
}
function U(e, t) {
  ee(e, t), ge(e, t);
}
function zo(e) {
  return (t) => {
    e.forEach((n) => {
      typeof n == "function" ? n(t) : n != null && (n.current = t);
    });
  };
}
function E(e) {
  const t = D();
  if (e || (e = t == null ? void 0 : t.editor), !e)
    throw new Error(
      "'editor' is required, either from BlockNoteContext or as a function argument"
    );
  const n = e, [o, r] = w(() => {
    var l;
    return ((l = n.getSelection()) == null ? void 0 : l.blocks) || [n.getTextCursorPosition().block];
  });
  return U(
    () => {
      var l;
      return r(
        ((l = n.getSelection()) == null ? void 0 : l.blocks) || [n.getTextCursorPosition().block]
      );
    },
    n
  ), o;
}
const jo = {
  bold: so,
  italic: go,
  underline: wo,
  strike: po,
  code: ro
};
function Wo(e, t) {
  return e in t.schema.styleSchema && t.schema.styleSchema[e].type === e && t.schema.styleSchema[e].propSchema === "boolean";
}
const re = (e) => {
  const t = M(), n = p(), o = C(), r = Wo(
    e.basicTextStyle,
    o
  ), l = E(o), [c, s] = w(
    e.basicTextStyle in o.getActiveStyles()
  );
  U(() => {
    r && s(e.basicTextStyle in o.getActiveStyles());
  }, o);
  const d = (h) => {
    if (o.focus(), !!r) {
      if (o.schema.styleSchema[h].propSchema !== "boolean")
        throw new Error("can only toggle boolean styles");
      o.toggleStyles({ [h]: !0 });
    }
  };
  if (!y(() => r ? !!l.find((h) => h.content !== void 0) : !1, [r, l]) || !o.isEditable)
    return null;
  const u = jo[e.basicTextStyle];
  return /* @__PURE__ */ i(
    n.FormattingToolbar.Button,
    {
      className: "bn-button",
      "data-test": e.basicTextStyle,
      onClick: () => d(e.basicTextStyle),
      isSelected: c,
      label: t.formatting_toolbar[e.basicTextStyle].tooltip,
      mainTooltip: t.formatting_toolbar[e.basicTextStyle].tooltip,
      secondaryTooltip: me(
        t.formatting_toolbar[e.basicTextStyle].secondary_tooltip,
        t.generic.ctrl_shortcut
      ),
      icon: /* @__PURE__ */ i(u, {})
    }
  );
}, ye = (e) => {
  const t = e.textColor || "default", n = e.backgroundColor || "default", o = e.size || 16, r = y(
    () => ({
      pointerEvents: "none",
      fontSize: (o * 0.75).toString() + "px",
      height: o.toString() + "px",
      lineHeight: o.toString() + "px",
      textAlign: "center",
      width: o.toString() + "px"
    }),
    [o]
  );
  return /* @__PURE__ */ i(
    "div",
    {
      className: "bn-color-icon",
      "data-background-color": n,
      "data-text-color": t,
      style: r,
      children: "A"
    }
  );
}, Je = [
  "default",
  "gray",
  "brown",
  "red",
  "orange",
  "yellow",
  "green",
  "blue",
  "purple",
  "pink"
], be = (e) => {
  const t = p(), n = M();
  return /* @__PURE__ */ v(S, { children: [
    /* @__PURE__ */ i(() => e.text ? /* @__PURE__ */ v(S, { children: [
      /* @__PURE__ */ i(t.Generic.Menu.Label, { children: n.color_picker.text_title }),
      Je.map((l) => /* @__PURE__ */ i(
        t.Generic.Menu.Item,
        {
          onClick: () => {
            e.onClick && e.onClick(), e.text.setColor(l);
          },
          "data-test": "text-color-" + l,
          icon: /* @__PURE__ */ i(ye, { textColor: l, size: e.iconSize }),
          checked: e.text.color === l,
          children: n.color_picker.colors[l]
        },
        "text-color-" + l
      ))
    ] }) : null, {}),
    /* @__PURE__ */ i(() => e.background ? /* @__PURE__ */ v(S, { children: [
      /* @__PURE__ */ i(t.Generic.Menu.Label, { children: n.color_picker.background_title }),
      Je.map((l) => /* @__PURE__ */ i(
        t.Generic.Menu.Item,
        {
          onClick: () => {
            e.onClick && e.onClick(), e.background.setColor(l);
          },
          "data-test": "background-color-" + l,
          icon: /* @__PURE__ */ i(ye, { backgroundColor: l, size: e.iconSize }),
          checked: e.background.color === l,
          children: n.color_picker.colors[l]
        },
        "background-color-" + l
      ))
    ] }) : null, {})
  ] });
};
function Qe(e, t) {
  return `${e}Color` in t.schema.styleSchema && t.schema.styleSchema[`${e}Color`].type === `${e}Color` && t.schema.styleSchema[`${e}Color`].propSchema === "string";
}
const qo = () => {
  const e = p(), t = M(), n = C(), o = Qe("text", n), r = Qe("background", n), l = E(n), [c, s] = w(
    o && n.getActiveStyles().textColor || "default"
  ), [d, a] = w(
    r && n.getActiveStyles().backgroundColor || "default"
  );
  U(() => {
    o && s(n.getActiveStyles().textColor || "default"), r && a(
      n.getActiveStyles().backgroundColor || "default"
    );
  }, n);
  const u = f(
    (g) => {
      if (!o)
        throw Error(
          "Tried to set text color, but style does not exist in editor schema."
        );
      g === "default" ? n.removeStyles({ textColor: g }) : n.addStyles({ textColor: g }), setTimeout(() => {
        n.focus();
      });
    },
    [n, o]
  ), h = f(
    (g) => {
      if (!r)
        throw Error(
          "Tried to set background color, but style does not exist in editor schema."
        );
      g === "default" ? n.removeStyles({ backgroundColor: g }) : n.addStyles({ backgroundColor: g }), setTimeout(() => {
        n.focus();
      });
    },
    [r, n]
  );
  return !y(() => {
    if (!o && !r)
      return !1;
    for (const g of l)
      if (g.content !== void 0)
        return !0;
    return !1;
  }, [r, l, o]) || !n.isEditable ? null : /* @__PURE__ */ v(e.Generic.Menu.Root, { children: [
    /* @__PURE__ */ i(e.Generic.Menu.Trigger, { children: /* @__PURE__ */ i(
      e.FormattingToolbar.Button,
      {
        className: "bn-button",
        "data-test": "colors",
        label: t.formatting_toolbar.colors.tooltip,
        mainTooltip: t.formatting_toolbar.colors.tooltip,
        icon: /* @__PURE__ */ i(
          ye,
          {
            textColor: c,
            backgroundColor: d,
            size: 20
          }
        )
      }
    ) }),
    /* @__PURE__ */ i(
      e.Generic.Menu.Dropdown,
      {
        className: "bn-menu-dropdown bn-color-picker-dropdown",
        children: /* @__PURE__ */ i(
          be,
          {
            text: o ? {
              color: c,
              setColor: u
            } : void 0,
            background: r ? {
              color: d,
              setColor: h
            } : void 0
          }
        )
      }
    )
  ] });
}, et = (e) => {
  for (const t of cn)
    if (e.startsWith(t))
      return e;
  return `${an}://${e}`;
}, Et = (e) => {
  const t = p(), n = M(), { url: o, text: r, editLink: l, showTextField: c } = e, [s, d] = w(o), [a, u] = w(r);
  x(() => {
    d(o), u(r);
  }, [r, o]);
  const h = f(
    (b) => {
      b.key === "Enter" && (b.preventDefault(), l(et(s), a));
    },
    [l, s, a]
  ), m = f(
    (b) => d(b.currentTarget.value),
    []
  ), g = f(
    (b) => u(b.currentTarget.value),
    []
  ), H = f(
    () => l(et(s), a),
    [l, s, a]
  );
  return /* @__PURE__ */ v(t.Generic.Form.Root, { children: [
    /* @__PURE__ */ i(
      t.Generic.Form.TextInput,
      {
        className: "bn-text-input",
        name: "url",
        icon: /* @__PURE__ */ i(Ht, {}),
        autoFocus: !0,
        placeholder: n.link_toolbar.form.url_placeholder,
        value: s,
        onKeyDown: h,
        onChange: m,
        onSubmit: H
      }
    ),
    c !== !1 && /* @__PURE__ */ i(
      t.Generic.Form.TextInput,
      {
        className: "bn-text-input",
        name: "title",
        icon: /* @__PURE__ */ i(Ze, {}),
        placeholder: n.link_toolbar.form.title_placeholder,
        value: a,
        onKeyDown: h,
        onChange: g,
        onSubmit: H
      }
    )
  ] });
};
function $o(e) {
  return "link" in e.schema.inlineContentSchema && e.schema.inlineContentSchema.link === "link";
}
const Ko = () => {
  var H;
  const e = C(), t = p(), n = M(), o = $o(e), r = E(e), [l, c] = w(!1), [s, d] = w(e.getSelectedLinkUrl() || ""), [a, u] = w(e.getSelectedText());
  U(() => {
    u(e.getSelectedText() || ""), d(e.getSelectedLinkUrl() || "");
  }, e), x(() => {
    var B;
    const b = (V) => {
      (V.ctrlKey || V.metaKey) && V.key === "k" && (c(!0), V.preventDefault());
    };
    return (B = e.prosemirrorView) == null || B.dom.addEventListener("keydown", b), () => {
      var V;
      (V = e.prosemirrorView) == null || V.dom.removeEventListener("keydown", b);
    };
  }, [(H = e.prosemirrorView) == null ? void 0 : H.dom]);
  const h = f(
    (b) => {
      e.createLink(b), e.focus();
    },
    [e]
  ), m = e.transact(
    (b) => sn(b.selection)
  );
  return !y(() => {
    if (!o)
      return !1;
    for (const b of r)
      if (b.content === void 0)
        return !1;
    return !m;
  }, [o, r, m]) || !("link" in e.schema.inlineContentSchema) || !e.isEditable ? null : /* @__PURE__ */ v(t.Generic.Popover.Root, { opened: l, children: [
    /* @__PURE__ */ i(t.Generic.Popover.Trigger, { children: /* @__PURE__ */ i(
      t.FormattingToolbar.Button,
      {
        className: "bn-button",
        "data-test": "createLink",
        label: n.formatting_toolbar.link.tooltip,
        mainTooltip: n.formatting_toolbar.link.tooltip,
        secondaryTooltip: me(
          n.formatting_toolbar.link.secondary_tooltip,
          n.generic.ctrl_shortcut
        ),
        icon: /* @__PURE__ */ i(Ht, {}),
        onClick: () => c(!0)
      }
    ) }),
    /* @__PURE__ */ i(
      t.Generic.Popover.Content,
      {
        className: "bn-popover-content bn-form-popover",
        variant: "form-popover",
        children: /* @__PURE__ */ i(
          Et,
          {
            url: s,
            text: a,
            editLink: h,
            showTextField: !1
          }
        )
      }
    )
  ] });
}, Xo = () => {
  const e = M(), t = p(), n = C(), [o, r] = w(), l = E(n), c = y(() => {
    if (l.length !== 1)
      return;
    const a = l[0];
    if (J(a, n))
      return r(a.props.caption), a;
  }, [n, l]), s = f(
    (a) => {
      c && a.key === "Enter" && (a.preventDefault(), n.updateBlock(c, {
        props: {
          caption: o
          // TODO
        }
      }));
    },
    [o, n, c]
  ), d = f(
    (a) => r(a.currentTarget.value),
    []
  );
  return !c || Q(c, n) || !n.isEditable ? null : /* @__PURE__ */ v(t.Generic.Popover.Root, { children: [
    /* @__PURE__ */ i(t.Generic.Popover.Trigger, { children: /* @__PURE__ */ i(
      t.FormattingToolbar.Button,
      {
        className: "bn-button",
        label: e.formatting_toolbar.file_caption.tooltip,
        mainTooltip: e.formatting_toolbar.file_caption.tooltip,
        icon: /* @__PURE__ */ i(Ke, {}),
        isSelected: c.props.caption !== ""
      }
    ) }),
    /* @__PURE__ */ i(
      t.Generic.Popover.Content,
      {
        className: "bn-popover-content bn-form-popover",
        variant: "form-popover",
        children: /* @__PURE__ */ i(t.Generic.Form.Root, { children: /* @__PURE__ */ i(
          t.Generic.Form.TextInput,
          {
            name: "file-caption",
            icon: /* @__PURE__ */ i(Ke, {}),
            value: o || "",
            autoFocus: !0,
            placeholder: e.formatting_toolbar.file_caption.input_placeholder,
            onKeyDown: s,
            onChange: d
          }
        ) })
      }
    )
  ] });
}, Yo = () => {
  const e = M(), t = p(), n = C(), o = E(n), r = y(() => {
    if (o.length !== 1)
      return;
    const c = o[0];
    if (J(c, n))
      return c;
  }, [n, o]), l = f(() => {
    n.focus(), n.removeBlocks([r]);
  }, [n, r]);
  return !r || Q(r, n) || !n.isEditable ? null : /* @__PURE__ */ i(
    t.FormattingToolbar.Button,
    {
      className: "bn-button",
      label: e.formatting_toolbar.file_delete.tooltip[r.type] || e.formatting_toolbar.file_delete.tooltip.file,
      mainTooltip: e.formatting_toolbar.file_delete.tooltip[r.type] || e.formatting_toolbar.file_delete.tooltip.file,
      icon: /* @__PURE__ */ i(Bo, {}),
      onClick: l
    }
  );
}, Jo = () => {
  const e = M(), t = p(), n = C(), [o, r] = w(), l = E(n), c = y(() => {
    if (l.length !== 1)
      return;
    const a = l[0];
    if (J(a, n))
      return r(a.props.name), a;
  }, [n, l]), s = f(
    (a) => {
      c && a.key === "Enter" && (a.preventDefault(), n.updateBlock(c, {
        props: {
          name: o
          // TODO
        }
      }));
    },
    [o, n, c]
  ), d = f(
    (a) => r(a.currentTarget.value),
    []
  );
  return !c || Q(c, n) || !n.isEditable ? null : /* @__PURE__ */ v(t.Generic.Popover.Root, { children: [
    /* @__PURE__ */ i(t.Generic.Popover.Trigger, { children: /* @__PURE__ */ i(
      t.FormattingToolbar.Button,
      {
        className: "bn-button",
        label: e.formatting_toolbar.file_rename.tooltip[c.type] || e.formatting_toolbar.file_rename.tooltip.file,
        mainTooltip: e.formatting_toolbar.file_rename.tooltip[c.type] || e.formatting_toolbar.file_rename.tooltip.file,
        icon: /* @__PURE__ */ i($e, {})
      }
    ) }),
    /* @__PURE__ */ i(
      t.Generic.Popover.Content,
      {
        className: "bn-popover-content bn-form-popover",
        variant: "form-popover",
        children: /* @__PURE__ */ i(t.Generic.Form.Root, { children: /* @__PURE__ */ i(
          t.Generic.Form.TextInput,
          {
            name: "file-name",
            icon: /* @__PURE__ */ i($e, {}),
            value: o || "",
            autoFocus: !0,
            placeholder: e.formatting_toolbar.file_rename.input_placeholder[c.type] || e.formatting_toolbar.file_rename.input_placeholder.file,
            onKeyDown: s,
            onChange: d
          }
        ) })
      }
    )
  ] });
}, Qo = () => {
  const e = M(), t = p(), n = C(), o = E(n), [r, l] = w(!1);
  x(() => {
    l(!1);
  }, [o]);
  const c = o.length === 1 ? o[0] : void 0;
  return c === void 0 || !J(c, n) || !n.isEditable ? null : /* @__PURE__ */ v(t.Generic.Popover.Root, { opened: r, position: "bottom", children: [
    /* @__PURE__ */ i(t.Generic.Popover.Trigger, { children: /* @__PURE__ */ i(
      t.FormattingToolbar.Button,
      {
        className: "bn-button",
        onClick: () => l(!r),
        isSelected: r,
        mainTooltip: e.formatting_toolbar.file_replace.tooltip[c.type] || e.formatting_toolbar.file_replace.tooltip.file,
        label: e.formatting_toolbar.file_replace.tooltip[c.type] || e.formatting_toolbar.file_replace.tooltip.file,
        icon: /* @__PURE__ */ i(Mo, {})
      }
    ) }),
    /* @__PURE__ */ i(
      t.Generic.Popover.Content,
      {
        className: "bn-popover-content bn-panel-popover",
        variant: "panel-popover",
        children: /* @__PURE__ */ i(Rt, { block: c })
      }
    )
  ] });
}, er = () => {
  const e = M(), t = p(), n = C(), o = E(n), [r, l] = w(
    () => n.canNestBlock()
  );
  U(() => {
    l(n.canNestBlock());
  }, n);
  const c = f(() => {
    n.focus(), n.nestBlock();
  }, [n]);
  return !y(() => !o.find(
    (d) => n.schema.blockSchema[d.type].content !== "inline"
  ), [n.schema.blockSchema, o]) || !n.isEditable ? null : /* @__PURE__ */ i(
    t.FormattingToolbar.Button,
    {
      className: "bn-button",
      "data-test": "nestBlock",
      onClick: c,
      isDisabled: !r,
      label: e.formatting_toolbar.nest.tooltip,
      mainTooltip: e.formatting_toolbar.nest.tooltip,
      secondaryTooltip: me(
        e.formatting_toolbar.nest.secondary_tooltip,
        e.generic.ctrl_shortcut
      ),
      icon: /* @__PURE__ */ i(ho, {})
    }
  );
}, tr = () => {
  const e = M(), t = p(), n = C(), o = E(n), [r, l] = w(
    () => n.canUnnestBlock()
  );
  U(() => {
    l(n.canUnnestBlock());
  }, n);
  const c = f(() => {
    n.focus(), n.unnestBlock();
  }, [n]);
  return !y(() => !o.find(
    (d) => n.schema.blockSchema[d.type].content !== "inline"
  ), [n.schema.blockSchema, o]) || !n.isEditable ? null : /* @__PURE__ */ i(
    t.FormattingToolbar.Button,
    {
      className: "bn-button",
      "data-test": "unnestBlock",
      onClick: c,
      isDisabled: !r,
      label: e.formatting_toolbar.unnest.tooltip,
      mainTooltip: e.formatting_toolbar.unnest.tooltip,
      secondaryTooltip: me(
        e.formatting_toolbar.unnest.secondary_tooltip,
        e.generic.ctrl_shortcut
      ),
      icon: /* @__PURE__ */ i(mo, {})
    }
  );
}, nr = (e) => [
  {
    name: e.slash_menu.paragraph.title,
    type: "paragraph",
    icon: Ze,
    isSelected: (t) => t.type === "paragraph"
  },
  {
    name: e.slash_menu.heading.title,
    type: "heading",
    props: { level: 1 },
    icon: ce,
    isSelected: (t) => t.type === "heading" && "level" in t.props && t.props.level === 1
  },
  {
    name: e.slash_menu.heading_2.title,
    type: "heading",
    props: { level: 2 },
    icon: ae,
    isSelected: (t) => t.type === "heading" && "level" in t.props && t.props.level === 2
  },
  {
    name: e.slash_menu.heading_3.title,
    type: "heading",
    props: { level: 3 },
    icon: se,
    isSelected: (t) => t.type === "heading" && "level" in t.props && t.props.level === 3
  },
  {
    name: e.slash_menu.heading_4.title,
    type: "heading",
    props: { level: 4 },
    icon: kt,
    isSelected: (t) => t.type === "heading" && "level" in t.props && t.props.level === 4
  },
  {
    name: e.slash_menu.heading_5.title,
    type: "heading",
    props: { level: 5 },
    icon: wt,
    isSelected: (t) => t.type === "heading" && "level" in t.props && t.props.level === 5
  },
  {
    name: e.slash_menu.heading_6.title,
    type: "heading",
    props: { level: 6 },
    icon: vt,
    isSelected: (t) => t.type === "heading" && "level" in t.props && t.props.level === 6
  },
  {
    name: e.slash_menu.toggle_heading.title,
    type: "heading",
    props: { level: 1, isToggleable: !0 },
    icon: ce,
    isSelected: (t) => t.type === "heading" && "level" in t.props && t.props.level === 1 && "isToggleable" in t.props && t.props.isToggleable
  },
  {
    name: e.slash_menu.toggle_heading_2.title,
    type: "heading",
    props: { level: 2, isToggleable: !0 },
    icon: ae,
    isSelected: (t) => t.type === "heading" && "level" in t.props && t.props.level === 2 && "isToggleable" in t.props && t.props.isToggleable
  },
  {
    name: e.slash_menu.toggle_heading_3.title,
    type: "heading",
    props: { level: 3, isToggleable: !0 },
    icon: se,
    isSelected: (t) => t.type === "heading" && "level" in t.props && t.props.level === 3 && "isToggleable" in t.props && t.props.isToggleable
  },
  {
    name: e.slash_menu.quote.title,
    type: "quote",
    icon: Vt,
    isSelected: (t) => t.type === "quote"
  },
  {
    name: e.slash_menu.toggle_list.title,
    type: "toggleListItem",
    icon: Tt,
    isSelected: (t) => t.type === "toggleListItem"
  },
  {
    name: e.slash_menu.bullet_list.title,
    type: "bulletListItem",
    icon: xt,
    isSelected: (t) => t.type === "bulletListItem"
  },
  {
    name: e.slash_menu.numbered_list.title,
    type: "numberedListItem",
    icon: yt,
    isSelected: (t) => t.type === "numberedListItem"
  },
  {
    name: e.slash_menu.check_list.title,
    type: "checkListItem",
    icon: Mt,
    isSelected: (t) => t.type === "checkListItem"
  }
], or = (e) => {
  const t = p(), n = M(), o = C(), r = E(o), [l, c] = w(o.getTextCursorPosition().block), s = y(() => (e.items || nr(n)).filter(
    (u) => u.type in o.schema.blockSchema
  ), [o, n, e.items]), d = y(
    () => s.find((u) => u.type === l.type) !== void 0,
    [l.type, s]
  ), a = y(() => {
    const u = (h) => {
      o.focus(), o.transact(() => {
        for (const m of r)
          o.updateBlock(m, {
            type: h.type,
            props: h.props
          });
      });
    };
    return s.map((h) => {
      const m = h.icon;
      return {
        text: h.name,
        icon: /* @__PURE__ */ i(m, { size: 16 }),
        onClick: () => u(h),
        isSelected: h.isSelected(l)
      };
    });
  }, [l, s, o, r]);
  return U(() => {
    c(o.getTextCursorPosition().block);
  }, o), !d || !o.isEditable ? null : /* @__PURE__ */ i(
    t.FormattingToolbar.Select,
    {
      className: "bn-select",
      items: a
    }
  );
}, rr = () => {
  const e = M(), t = p(), n = C(), o = f(() => {
    var r;
    (r = n.comments) == null || r.startPendingComment(), n.formattingToolbar.closeMenu();
  }, [n]);
  return n.comments ? /* @__PURE__ */ i(
    t.FormattingToolbar.Button,
    {
      className: "bn-button",
      label: e.formatting_toolbar.comment.tooltip,
      mainTooltip: e.formatting_toolbar.comment.tooltip,
      icon: /* @__PURE__ */ i(pt, {}),
      onClick: o
    }
  ) : null;
}, ir = () => {
  const e = M(), t = p(), n = C(), o = f(() => {
    n._tiptapEditor.chain().focus().addPendingComment().run();
  }, [n]);
  return (
    // We manually check if a comment extension (like liveblocks) is installed
    // By adding default support for this, the user doesn't need to customize the formatting toolbar
    !n._tiptapEditor.commands.addPendingComment || !n.isEditable ? null : /* @__PURE__ */ i(
      t.FormattingToolbar.Button,
      {
        className: "bn-button",
        label: e.formatting_toolbar.comment.tooltip,
        mainTooltip: e.formatting_toolbar.comment.tooltip,
        icon: /* @__PURE__ */ i(pt, {}),
        onClick: o
      }
    )
  );
};
function xe(e, t) {
  try {
    const n = new URL(e, t);
    if (n.protocol !== "javascript:")
      return n.href;
  } catch {
  }
  return "#";
}
const lr = () => {
  const e = M(), t = p(), n = C(), o = E(n), r = y(() => {
    if (o.length !== 1)
      return;
    const c = o[0];
    if (J(c, n))
      return c;
  }, [n, o]), l = f(() => {
    r && r.props.url && (n.focus(), n.resolveFileUrl ? n.resolveFileUrl(r.props.url).then(
      (c) => window.open(xe(c, window.location.href))
    ) : window.open(xe(r.props.url, window.location.href)));
  }, [n, r]);
  return !r || Q(r, n) ? null : /* @__PURE__ */ i(
    t.FormattingToolbar.Button,
    {
      className: "bn-button",
      label: e.formatting_toolbar.file_download.tooltip[r.type] || e.formatting_toolbar.file_download.tooltip.file,
      mainTooltip: e.formatting_toolbar.file_download.tooltip[r.type] || e.formatting_toolbar.file_download.tooltip.file,
      icon: /* @__PURE__ */ i(So, {}),
      onClick: l
    }
  );
}, cr = () => {
  const e = M(), t = p(), n = C(), o = E(n), r = y(() => {
    if (o.length !== 1)
      return;
    const c = o[0];
    if (dn(c, n))
      return c;
  }, [n, o]), l = f(() => {
    r && n.updateBlock(r, {
      props: {
        showPreview: !r.props.showPreview
        // TODO
      }
    });
  }, [n, r]);
  return !r || Q(r, n) || !n.isEditable ? null : /* @__PURE__ */ i(
    t.FormattingToolbar.Button,
    {
      className: "bn-button",
      label: "Toggle preview",
      mainTooltip: e.formatting_toolbar.file_preview_toggle.tooltip,
      icon: /* @__PURE__ */ i(Ho, {}),
      isSelected: r.props.showPreview,
      onClick: l
    }
  );
}, ar = () => {
  const e = M(), t = p(), n = C(), o = E(n), r = y(() => {
    var s;
    if (o.length !== 1)
      return;
    const c = o[0];
    if (c.type === "table")
      return (s = n.tableHandles) == null ? void 0 : s.getMergeDirection(c);
  }, [n, o]), l = f(() => {
    var c;
    (c = n.tableHandles) == null || c.mergeCells();
  }, [n]);
  return !n.isEditable || r === void 0 || !n.settings.tables.splitCells ? null : /* @__PURE__ */ i(
    t.FormattingToolbar.Button,
    {
      className: "bn-button",
      label: e.formatting_toolbar.table_cell_merge.tooltip,
      mainTooltip: e.formatting_toolbar.table_cell_merge.tooltip,
      icon: r === "horizontal" ? /* @__PURE__ */ i(bo, {}) : /* @__PURE__ */ i(Co, {}),
      onClick: l
    }
  );
}, sr = {
  left: co,
  center: io,
  right: ao,
  justify: lo
}, we = (e) => {
  const t = p(), n = M(), o = C(), r = E(o), l = y(() => {
    var u;
    const a = r[0];
    if (Me("textAlignment", a, o))
      return a.props.textAlignment;
    if (a.type === "table") {
      const h = (u = o.tableHandles) == null ? void 0 : u.getCellSelection();
      if (!h)
        return;
      const m = h.cells.map(
        ({ row: H, col: b }) => K(
          a.content.rows[H].cells[b]
        ).props.textAlignment
      ), g = m[0];
      if (m.every((H) => H === g))
        return g;
    }
  }, [o, r]), c = f(
    (a) => {
      var u;
      o.focus();
      for (const h of r)
        if ($("textAlignment", h.type, o))
          o.updateBlock(h, {
            props: { textAlignment: a }
          });
        else if (h.type === "table") {
          const m = (u = o.tableHandles) == null ? void 0 : u.getCellSelection();
          if (!m)
            continue;
          const g = h.content.rows.map(
            (H) => ({
              ...H,
              cells: H.cells.map((b) => K(b))
            })
          );
          m.cells.forEach(({ row: H, col: b }) => {
            g[H].cells[b].props.textAlignment = a;
          }), o.updateBlock(h, {
            type: "table",
            content: {
              ...h.content,
              type: "tableContent",
              rows: g
            }
          }), o.setTextCursorPosition(h);
        }
    },
    [o, r]
  );
  if (!y(() => !!r.find(
    (a) => "textAlignment" in a.props || a.type === "table" && a.children
  ), [r]) || !o.isEditable)
    return null;
  const d = sr[e.textAlignment];
  return /* @__PURE__ */ i(
    t.FormattingToolbar.Button,
    {
      className: "bn-button",
      "data-test": `alignText${e.textAlignment.slice(0, 1).toUpperCase() + e.textAlignment.slice(1)}`,
      onClick: () => c(e.textAlignment),
      isSelected: l === e.textAlignment,
      label: n.formatting_toolbar[`align_${e.textAlignment}`].tooltip,
      mainTooltip: n.formatting_toolbar[`align_${e.textAlignment}`].tooltip,
      icon: /* @__PURE__ */ i(d, {})
    }
  );
}, dr = (e) => [
  /* @__PURE__ */ i(or, { items: e }, "blockTypeSelect"),
  /* @__PURE__ */ i(ar, {}, "tableCellMergeButton"),
  /* @__PURE__ */ i(Xo, {}, "fileCaptionButton"),
  /* @__PURE__ */ i(Qo, {}, "replaceFileButton"),
  /* @__PURE__ */ i(Jo, {}, "fileRenameButton"),
  /* @__PURE__ */ i(Yo, {}, "fileDeleteButton"),
  /* @__PURE__ */ i(lr, {}, "fileDownloadButton"),
  /* @__PURE__ */ i(cr, {}, "filePreviewButton"),
  /* @__PURE__ */ i(re, { basicTextStyle: "bold" }, "boldStyleButton"),
  /* @__PURE__ */ i(re, { basicTextStyle: "italic" }, "italicStyleButton"),
  /* @__PURE__ */ i(
    re,
    {
      basicTextStyle: "underline"
    },
    "underlineStyleButton"
  ),
  /* @__PURE__ */ i(re, { basicTextStyle: "strike" }, "strikeStyleButton"),
  /* @__PURE__ */ i(we, { textAlignment: "left" }, "textAlignLeftButton"),
  /* @__PURE__ */ i(we, { textAlignment: "center" }, "textAlignCenterButton"),
  /* @__PURE__ */ i(we, { textAlignment: "right" }, "textAlignRightButton"),
  /* @__PURE__ */ i(qo, {}, "colorStyleButton"),
  /* @__PURE__ */ i(er, {}, "nestBlockButton"),
  /* @__PURE__ */ i(tr, {}, "unnestBlockButton"),
  /* @__PURE__ */ i(Ko, {}, "createLinkButton"),
  /* @__PURE__ */ i(rr, {}, "addCommentButton"),
  /* @__PURE__ */ i(ir, {}, "addTiptapCommentButton")
], It = (e) => {
  const t = p();
  return /* @__PURE__ */ i(
    t.FormattingToolbar.Root,
    {
      className: "bn-toolbar bn-formatting-toolbar",
      children: e.children || dr(e.blockTypeSelectItems)
    }
  );
}, tt = (e) => {
  switch (e) {
    case "left":
      return "top-start";
    case "center":
      return "top";
    case "right":
      return "top-end";
    default:
      return "top-start";
  }
}, ur = (e) => {
  const t = N(null), n = C(), [o, r] = w(
    () => {
      const m = n.getTextCursorPosition().block;
      return "textAlignment" in m.props ? tt(
        m.props.textAlignment
      ) : "top-start";
    }
  );
  U(() => {
    const m = n.getTextCursorPosition().block;
    "textAlignment" in m.props ? r(
      tt(
        m.props.textAlignment
      )
    ) : r("top-start");
  }, n);
  const l = Z(
    n.formattingToolbar.onUpdate.bind(n.formattingToolbar)
  ), { isMounted: c, ref: s, style: d, getFloatingProps: a } = G(
    (l == null ? void 0 : l.show) || !1,
    (l == null ? void 0 : l.referencePos) || null,
    3e3,
    {
      placement: o,
      middleware: [A(10), ue(), W()],
      onOpenChange: (m, g) => {
        m || (n.formattingToolbar.closeMenu(), n.focus());
      },
      canDismiss: {
        enabled: !0,
        escapeKey: !0,
        outsidePress: (m) => {
          var b;
          const g = (b = n._tiptapEditor) == null ? void 0 : b.view;
          return !g || !m.target ? !1 : !Uo(m, g.dom.parentElement);
        }
      },
      ...e.floatingOptions
    }
  ), u = y(() => zo([t, s]), [t, s]);
  if (!c || !l)
    return null;
  if (!l.show && t.current)
    return /* @__PURE__ */ i(
      "div",
      {
        ref: u,
        style: d,
        dangerouslySetInnerHTML: { __html: t.current.innerHTML }
      }
    );
  const h = e.formattingToolbar || It;
  return /* @__PURE__ */ i("div", { ref: u, style: d, ...a(), children: /* @__PURE__ */ i(h, {}) });
}, mr = (e) => {
  const t = p(), n = M();
  return /* @__PURE__ */ i(
    t.LinkToolbar.Button,
    {
      className: "bn-button",
      label: n.link_toolbar.delete.tooltip,
      mainTooltip: n.link_toolbar.delete.tooltip,
      isSelected: !1,
      onClick: e.deleteLink,
      icon: /* @__PURE__ */ i(fo, {})
    }
  );
}, hr = (e) => {
  const t = p(), n = M();
  return /* @__PURE__ */ v(t.Generic.Popover.Root, { children: [
    /* @__PURE__ */ i(t.Generic.Popover.Trigger, { children: /* @__PURE__ */ i(
      t.LinkToolbar.Button,
      {
        className: "bn-button",
        mainTooltip: n.link_toolbar.edit.tooltip,
        isSelected: !1,
        children: n.link_toolbar.edit.text
      }
    ) }),
    /* @__PURE__ */ i(
      t.Generic.Popover.Content,
      {
        className: "bn-popover-content bn-form-popover",
        variant: "form-popover",
        children: /* @__PURE__ */ i(Et, { ...e })
      }
    )
  ] });
}, gr = (e) => {
  const t = p(), n = M();
  return /* @__PURE__ */ i(
    t.LinkToolbar.Button,
    {
      className: "bn-button",
      mainTooltip: n.link_toolbar.open.tooltip,
      label: n.link_toolbar.open.tooltip,
      isSelected: !1,
      onClick: () => {
        window.open(xe(e.url, window.location.href), "_blank");
      },
      icon: /* @__PURE__ */ i(Lo, {})
    }
  );
}, fr = (e) => {
  const t = p();
  return e.children ? /* @__PURE__ */ i(t.LinkToolbar.Root, { className: "bn-toolbar bn-link-toolbar", children: e.children }) : /* @__PURE__ */ v(
    t.LinkToolbar.Root,
    {
      className: "bn-toolbar bn-link-toolbar",
      onMouseEnter: e.stopHideTimer,
      onMouseLeave: e.startHideTimer,
      children: [
        /* @__PURE__ */ i(
          hr,
          {
            url: e.url,
            text: e.text,
            editLink: e.editLink
          }
        ),
        /* @__PURE__ */ i(gr, { url: e.url }),
        /* @__PURE__ */ i(mr, { deleteLink: e.deleteLink })
      ]
    }
  );
}, br = (e) => {
  const t = C(), n = {
    deleteLink: t.linkToolbar.deleteLink,
    editLink: t.linkToolbar.editLink,
    startHideTimer: t.linkToolbar.startHideTimer,
    stopHideTimer: t.linkToolbar.stopHideTimer
  }, o = Z(
    t.linkToolbar.onUpdate.bind(t.linkToolbar)
  ), { isMounted: r, ref: l, style: c, getFloatingProps: s } = G(
    (o == null ? void 0 : o.show) || !1,
    (o == null ? void 0 : o.referencePos) || null,
    4e3,
    {
      placement: "top-start",
      middleware: [A(10), W()],
      onOpenChange: (m) => {
        m || (t.linkToolbar.closeMenu(), t.focus());
      },
      ...e.floatingOptions
    }
  );
  if (!r || !o)
    return null;
  const { show: d, referencePos: a, ...u } = o, h = e.linkToolbar || fr;
  return /* @__PURE__ */ i("div", { ref: l, style: c, ...s(), children: /* @__PURE__ */ i(h, { ...u, ...n }) });
};
function Cr(e) {
  return k({ attr: { viewBox: "0 0 1024 1024" }, child: [{ tag: "path", attr: { d: "M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8Z" }, child: [] }, { tag: "path", attr: { d: "M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8Z" }, child: [] }] })(e);
}
const pr = (e) => {
  const t = p(), n = M(), o = C(), r = f(() => {
    const l = e.block.content;
    if (l !== void 0 && Array.isArray(l) && l.length === 0)
      o.setTextCursorPosition(e.block), o.openSuggestionMenu("/");
    else {
      const s = o.insertBlocks(
        [{ type: "paragraph" }],
        e.block,
        "after"
      )[0];
      o.setTextCursorPosition(s), o.openSuggestionMenu("/");
    }
  }, [o, e.block]);
  return /* @__PURE__ */ i(
    t.SideMenu.Button,
    {
      className: "bn-button",
      label: n.side_menu.add_block_label,
      icon: /* @__PURE__ */ i(Cr, { size: 24, onClick: r, "data-test": "dragHandleAdd" })
    }
  );
};
function Nt(e) {
  return k({ attr: { viewBox: "0 0 24 24" }, child: [{ tag: "path", attr: { fill: "none", d: "M0 0h24v24H0V0z" }, child: [] }, { tag: "path", attr: { d: "M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" }, child: [] }] })(e);
}
function kr(e) {
  return k({ attr: { viewBox: "0 0 24 24" }, child: [{ tag: "path", attr: { fill: "none", d: "M0 0h24v24H0z" }, child: [] }, { tag: "path", attr: { d: "m7 10 5 5 5-5z" }, child: [] }] })(e);
}
const wr = (e) => {
  const t = p(), n = C();
  return !$("textColor", e.block.type, n) && !$("backgroundColor", e.block.type, n) ? null : /* @__PURE__ */ v(t.Generic.Menu.Root, { position: "right", sub: !0, children: [
    /* @__PURE__ */ i(t.Generic.Menu.Trigger, { sub: !0, children: /* @__PURE__ */ i(
      t.Generic.Menu.Item,
      {
        className: "bn-menu-item",
        subTrigger: !0,
        children: e.children
      }
    ) }),
    /* @__PURE__ */ i(
      t.Generic.Menu.Dropdown,
      {
        sub: !0,
        className: "bn-menu-dropdown bn-color-picker-dropdown",
        children: /* @__PURE__ */ i(
          be,
          {
            iconSize: 18,
            text: $(
              "textColor",
              e.block.type,
              n
            ) && Me("textColor", e.block, n) ? {
              color: e.block.props.textColor,
              setColor: (o) => n.updateBlock(e.block, {
                type: e.block.type,
                props: { textColor: o }
              })
            } : void 0,
            background: $(
              "backgroundColor",
              e.block.type,
              n
            ) && Me("backgroundColor", e.block, n) ? {
              color: e.block.props.backgroundColor,
              setColor: (o) => n.updateBlock(e.block, {
                props: { backgroundColor: o }
              })
            } : void 0
          }
        )
      }
    )
  ] });
}, vr = (e) => {
  const t = p(), n = C();
  return /* @__PURE__ */ i(
    t.Generic.Menu.Item,
    {
      className: "bn-menu-item",
      onClick: () => n.removeBlocks([e.block]),
      children: e.children
    }
  );
}, Hr = (e) => {
  const t = p(), n = C();
  if (e.block.type !== "table" || !n.settings.tables.headers)
    return null;
  const o = !!e.block.content.headerRows;
  return /* @__PURE__ */ i(
    t.Generic.Menu.Item,
    {
      className: "bn-menu-item",
      checked: o,
      onClick: () => {
        const r = n.getBlock(e.block.id);
        r && n.updateBlock(r, {
          ...r,
          content: {
            ...r.content,
            headerRows: o ? void 0 : 1
          }
        });
      },
      children: e.children
    }
  );
}, Mr = (e) => {
  const t = p(), n = C();
  if (e.block.type !== "table" || !n.settings.tables.headers)
    return null;
  const o = !!e.block.content.headerCols;
  return /* @__PURE__ */ i(
    t.Generic.Menu.Item,
    {
      className: "bn-menu-item",
      checked: o,
      onClick: () => {
        n.updateBlock(e.block, {
          type: "table",
          content: {
            ...e.block.content,
            type: "tableContent",
            headerCols: o ? void 0 : 1
          }
        });
      },
      children: e.children
    }
  );
}, yr = (e) => {
  const t = p(), n = M();
  return /* @__PURE__ */ i(
    t.Generic.Menu.Dropdown,
    {
      className: "bn-menu-dropdown bn-drag-handle-menu",
      children: e.children || /* @__PURE__ */ v(S, { children: [
        /* @__PURE__ */ i(vr, { ...e, children: n.drag_handle.delete_menuitem }),
        /* @__PURE__ */ i(wr, { ...e, children: n.drag_handle.colors_menuitem }),
        /* @__PURE__ */ i(Hr, { ...e, children: n.drag_handle.header_row_menuitem }),
        /* @__PURE__ */ i(Mr, { ...e, children: n.drag_handle.header_column_menuitem })
      ] })
    }
  );
}, xr = (e) => {
  const t = p(), n = M(), o = e.dragHandleMenu || yr;
  return /* @__PURE__ */ v(
    t.Generic.Menu.Root,
    {
      onOpenChange: (r) => {
        r ? e.freezeMenu() : e.unfreezeMenu();
      },
      position: "left",
      children: [
        /* @__PURE__ */ i(t.Generic.Menu.Trigger, { children: /* @__PURE__ */ i(
          t.SideMenu.Button,
          {
            label: n.side_menu.drag_handle_label,
            draggable: !0,
            onDragStart: (r) => e.blockDragStart(r, e.block),
            onDragEnd: e.blockDragEnd,
            className: "bn-button",
            icon: /* @__PURE__ */ i(Nt, { size: 24, "data-test": "dragHandle" })
          }
        ) }),
        /* @__PURE__ */ i(o, { block: e.block, children: e.children })
      ]
    }
  );
}, Vr = (e) => {
  const t = p(), n = y(() => {
    const o = {
      "data-block-type": e.block.type
    };
    return e.block.type === "heading" && (o["data-level"] = e.block.props.level.toString()), e.editor.schema.blockSchema[e.block.type].isFileBlock && (e.block.props.url ? o["data-url"] = "true" : o["data-url"] = "false"), o;
  }, [e.block, e.editor.schema.blockSchema]);
  return /* @__PURE__ */ i(t.SideMenu.Root, { className: "bn-side-menu", ...n, children: e.children || /* @__PURE__ */ v(S, { children: [
    /* @__PURE__ */ i(pr, { ...e }),
    /* @__PURE__ */ i(xr, { ...e })
  ] }) });
}, Br = (e) => {
  const t = C(), n = {
    blockDragStart: t.sideMenu.blockDragStart,
    blockDragEnd: t.sideMenu.blockDragEnd,
    freezeMenu: t.sideMenu.freezeMenu,
    unfreezeMenu: t.sideMenu.unfreezeMenu
  }, o = Z(
    t.sideMenu.onUpdate.bind(t.sideMenu)
  ), { isMounted: r, ref: l, style: c, getFloatingProps: s } = G(
    (o == null ? void 0 : o.show) || !1,
    (o == null ? void 0 : o.referencePos) || null,
    1e3,
    {
      placement: "left-start",
      ...e.floatingOptions
    }
  );
  if (!r || !o)
    return null;
  const { show: d, referencePos: a, ...u } = o, h = e.sideMenu || Vr;
  return /* @__PURE__ */ i("div", { ref: l, style: c, ...s(), children: /* @__PURE__ */ i(h, { ...u, ...n, editor: t }) });
};
async function Tr(e, t) {
  return (await un(e, t)).map(
    ({ id: n, onItemClick: o }) => ({
      id: n,
      onItemClick: o,
      icon: n
    })
  );
}
function Sr(e) {
  const t = p(), n = M(), { items: o, loadingState: r, selectedIndex: l, onItemClick: c, columns: s } = e, d = r === "loading-initial" || r === "loading" ? /* @__PURE__ */ i(
    t.GridSuggestionMenu.Loader,
    {
      className: "bn-grid-suggestion-menu-loader",
      columns: s
    }
  ) : null, a = y(() => {
    const u = [];
    for (let h = 0; h < o.length; h++) {
      const m = o[h];
      u.push(
        /* @__PURE__ */ i(
          t.GridSuggestionMenu.Item,
          {
            className: "bn-grid-suggestion-menu-item",
            item: m,
            id: `bn-grid-suggestion-menu-item-${h}`,
            isSelected: h === l,
            onClick: () => c == null ? void 0 : c(m)
          },
          m.id
        )
      );
    }
    return u;
  }, [t, o, c, l]);
  return /* @__PURE__ */ v(
    t.GridSuggestionMenu.Root,
    {
      id: "bn-grid-suggestion-menu",
      columns: s,
      className: "bn-grid-suggestion-menu",
      children: [
        d,
        a,
        a.length === 0 && e.loadingState === "loaded" && /* @__PURE__ */ i(
          t.GridSuggestionMenu.EmptyItem,
          {
            className: "bn-grid-suggestion-menu-empty-item",
            columns: s,
            children: n.suggestion_menu.no_items_title
          }
        )
      ]
    }
  );
}
function Pt(e, t, n, o = 3) {
  const r = N(0);
  x(() => {
    t !== void 0 && (e.length > 0 ? r.current = t.length : t.length - r.current > o && n());
  }, [n, o, e.length, t]);
}
function Zt(e, t) {
  const [n, o] = w([]), [r, l] = w(!1), c = N(), s = N();
  return x(() => {
    const d = e;
    c.current = e, l(!0), t(e).then((a) => {
      c.current === d && (o(a), l(!1), s.current = d);
    });
  }, [e, t]), {
    items: n || [],
    // The query that was used to retrieve the last set of items may not be the
    // same as the current query as the items from the current query may not
    // have been retrieved yet. This is useful when using the returns of this
    // hook in other hooks.
    usedQuery: s.current,
    loadingState: s.current === void 0 ? "loading-initial" : r ? "loading" : "loaded"
  };
}
function Lr(e, t, n, o, r) {
  const [l, c] = w(0), s = o !== void 0 && o > 1;
  return x(() => {
    var a;
    const d = (u) => (u.key === "ArrowLeft" && (u.preventDefault(), n.length && c((l - 1 + n.length) % n.length)), u.key === "ArrowRight" && (u.preventDefault(), n.length && c((l + 1 + n.length) % n.length)), u.key === "ArrowUp" ? (u.preventDefault(), n.length && c(
      (l - o + n.length) % n.length
    ), !0) : u.key === "ArrowDown" ? (u.preventDefault(), n.length && c((l + o) % n.length), !0) : u.key === "Enter" && !u.isComposing ? (u.stopPropagation(), u.preventDefault(), n.length && (r == null || r(n[l])), !0) : !1);
    return (a = e.domElement) == null || a.addEventListener(
      "keydown",
      d,
      !0
    ), () => {
      var u;
      (u = e.domElement) == null || u.removeEventListener(
        "keydown",
        d,
        !0
      );
    };
  }, [e.domElement, n, l, r, o, s]), x(() => {
    c(0);
  }, [t]), {
    selectedIndex: n.length === 0 ? void 0 : l
  };
}
function _r(e) {
  const n = D().setContentEditableProps, o = C(), {
    getItems: r,
    gridSuggestionMenuComponent: l,
    query: c,
    clearQuery: s,
    closeMenu: d,
    onItemClick: a,
    columns: u
  } = e, h = f(
    (V) => {
      d(), s(), a == null || a(V);
    },
    [a, d, s]
  ), { items: m, usedQuery: g, loadingState: H } = Zt(
    c,
    r
  );
  Pt(m, g, d);
  const { selectedIndex: b } = Lr(
    o,
    c,
    m,
    u,
    h
  );
  return x(() => (n((V) => ({
    ...V,
    "aria-expanded": !0,
    "aria-controls": "bn-suggestion-menu"
  })), () => {
    n((V) => ({
      ...V,
      "aria-expanded": !1,
      "aria-controls": void 0
    }));
  }), [n]), x(() => (n((V) => ({
    ...V,
    "aria-activedescendant": b ? "bn-suggestion-menu-item-" + b : void 0
  })), () => {
    n((V) => ({
      ...V,
      "aria-activedescendant": void 0
    }));
  }), [n, b]), /* @__PURE__ */ i(
    l,
    {
      items: m,
      onItemClick: h,
      loadingState: H,
      selectedIndex: b,
      columns: u
    }
  );
}
function Rr(e) {
  const t = C(), {
    triggerCharacter: n,
    gridSuggestionMenuComponent: o,
    columns: r,
    minQueryLength: l,
    onItemClick: c,
    getItems: s,
    floatingOptions: d
  } = e, a = y(() => c || ((T) => {
    T.onItemClick(t);
  }), [t, c]), u = y(() => s || (async (T) => await Tr(
    t,
    T
  )), [t, s]), h = {
    closeMenu: t.suggestionMenus.closeMenu,
    clearQuery: t.suggestionMenus.clearQuery
  }, m = f(
    (T) => t.suggestionMenus.onUpdate(n, T),
    [t.suggestionMenus, n]
  ), g = Z(m), { isMounted: H, ref: b, style: B, getFloatingProps: V } = G(
    (g == null ? void 0 : g.show) || !1,
    (g == null ? void 0 : g.referencePos) || null,
    2e3,
    {
      placement: "bottom-start",
      middleware: [
        A(10),
        // Flips the menu placement to maximize the space available, and prevents
        // the menu from being cut off by the confines of the screen.
        W(),
        Re({
          apply({ availableHeight: T, elements: I }) {
            Object.assign(I.floating.style, {
              maxHeight: `${T - 10}px`
            });
          }
        })
      ],
      onOpenChange(T) {
        T || t.suggestionMenus.closeMenu();
      },
      ...d
    }
  );
  return !H || !g || !(g != null && g.ignoreQueryLength) && l && (g.query.startsWith(" ") || g.query.length < l) ? null : /* @__PURE__ */ i("div", { ref: b, style: B, ...V(), children: /* @__PURE__ */ i(
    _r,
    {
      query: g.query,
      closeMenu: h.closeMenu,
      clearQuery: h.clearQuery,
      getItems: u,
      columns: r,
      gridSuggestionMenuComponent: o || Sr,
      onItemClick: a
    }
  ) });
}
function Er(e) {
  const t = p(), n = M(), { items: o, loadingState: r, selectedIndex: l, onItemClick: c } = e, s = r === "loading-initial" || r === "loading" ? /* @__PURE__ */ i(
    t.SuggestionMenu.Loader,
    {
      className: "bn-suggestion-menu-loader"
    }
  ) : null, d = y(() => {
    let a;
    const u = [];
    for (let h = 0; h < o.length; h++) {
      const m = o[h];
      m.group !== a && (a = m.group, u.push(
        /* @__PURE__ */ i(
          t.SuggestionMenu.Label,
          {
            className: "bn-suggestion-menu-label",
            children: a
          },
          a
        )
      )), u.push(
        /* @__PURE__ */ i(
          t.SuggestionMenu.Item,
          {
            className: _(
              "bn-suggestion-menu-item",
              m.size === "small" ? "bn-suggestion-menu-item-small" : ""
            ),
            item: m,
            id: `bn-suggestion-menu-item-${h}`,
            isSelected: h === l,
            onClick: () => c == null ? void 0 : c(m)
          },
          m.title
        )
      );
    }
    return u;
  }, [t, o, c, l]);
  return /* @__PURE__ */ v(
    t.SuggestionMenu.Root,
    {
      id: "bn-suggestion-menu",
      className: "bn-suggestion-menu",
      children: [
        d,
        d.length === 0 && (e.loadingState === "loading" || e.loadingState === "loaded") && /* @__PURE__ */ i(
          t.SuggestionMenu.EmptyItem,
          {
            className: "bn-suggestion-menu-item",
            children: n.suggestion_menu.no_items_title
          }
        ),
        s
      ]
    }
  );
}
function Ir(e, t) {
  const [n, o] = w(0);
  return {
    selectedIndex: n,
    setSelectedIndex: o,
    handler: (r) => {
      if (r.key === "ArrowUp")
        return r.preventDefault(), e.length && o((n - 1 + e.length) % e.length), !0;
      if (r.key === "ArrowDown")
        return r.preventDefault(), e.length && o((n + 1) % e.length), !0;
      const l = Nr(r) ? r.nativeEvent.isComposing : r.isComposing;
      return r.key === "Enter" && !l ? (r.preventDefault(), r.stopPropagation(), e.length && (t == null || t(e[n])), !0) : !1;
    }
  };
}
function Nr(e) {
  return e.nativeEvent !== void 0;
}
function Pr(e, t, n, o, r) {
  const { selectedIndex: l, setSelectedIndex: c, handler: s } = Ir(n, o);
  return x(() => {
    var d;
    return (d = r || e.domElement) == null || d.addEventListener("keydown", s, !0), () => {
      var a;
      (a = r || e.domElement) == null || a.removeEventListener(
        "keydown",
        s,
        !0
      );
    };
  }, [e.domElement, n, l, o, r, s]), x(() => {
    c(0);
  }, [t, c]), {
    selectedIndex: n.length === 0 ? void 0 : l
  };
}
function Zr(e) {
  const n = D().setContentEditableProps, o = C(), {
    getItems: r,
    suggestionMenuComponent: l,
    query: c,
    clearQuery: s,
    closeMenu: d,
    onItemClick: a
  } = e, u = f(
    (B) => {
      d(), s(), a == null || a(B);
    },
    [a, d, s]
  ), { items: h, usedQuery: m, loadingState: g } = Zt(
    c,
    r
  );
  Pt(h, m, d);
  const { selectedIndex: H } = Pr(
    o,
    c,
    h,
    u
  );
  return x(() => (n((B) => ({
    ...B,
    "aria-expanded": !0,
    "aria-controls": "bn-suggestion-menu"
  })), () => {
    n((B) => ({
      ...B,
      "aria-expanded": !1,
      "aria-controls": void 0
    }));
  }), [n]), x(() => (n((B) => ({
    ...B,
    "aria-activedescendant": H ? "bn-suggestion-menu-item-" + H : void 0
  })), () => {
    n((B) => ({
      ...B,
      "aria-activedescendant": void 0
    }));
  }), [n, H]), /* @__PURE__ */ i(
    l,
    {
      items: h,
      onItemClick: u,
      loadingState: g,
      selectedIndex: H
    }
  );
}
const Dr = {
  heading: ce,
  heading_2: ae,
  heading_3: se,
  heading_4: kt,
  heading_5: wt,
  heading_6: vt,
  toggle_heading: ce,
  toggle_heading_2: ae,
  toggle_heading_3: se,
  quote: Vt,
  toggle_list: Tt,
  numbered_list: yt,
  bullet_list: xt,
  check_list: Mt,
  paragraph: Ze,
  table: ko,
  image: Bt,
  video: vo,
  audio: St,
  file: Pe,
  emoji: Ro,
  code_block: uo
};
function Or(e) {
  return mn(e).map((t) => {
    const n = Dr[t.key];
    return {
      ...t,
      icon: /* @__PURE__ */ i(n, { size: 18 })
    };
  });
}
function Fr(e) {
  const t = C(), {
    triggerCharacter: n,
    suggestionMenuComponent: o,
    minQueryLength: r,
    onItemClick: l,
    getItems: c,
    floatingOptions: s
  } = e, d = y(() => l || ((V) => {
    V.onItemClick(t);
  }), [t, l]), a = y(() => c || (async (V) => hn(
    Or(t),
    V
  )), [t, c]), u = {
    closeMenu: t.suggestionMenus.closeMenu,
    clearQuery: t.suggestionMenus.clearQuery
  }, h = f(
    (V) => t.suggestionMenus.onUpdate(n, V),
    [t.suggestionMenus, n]
  ), m = Z(h), { isMounted: g, ref: H, style: b, getFloatingProps: B } = G(
    (m == null ? void 0 : m.show) || !1,
    (m == null ? void 0 : m.referencePos) || null,
    2e3,
    {
      placement: "bottom-start",
      middleware: [
        A(10),
        // Flips the menu placement to maximize the space available, and prevents
        // the menu from being cut off by the confines of the screen.
        W({
          mainAxis: !0,
          crossAxis: !1
        }),
        ue(),
        Re({
          apply({ availableHeight: V, elements: T }) {
            Object.assign(T.floating.style, {
              maxHeight: `${V - 10}px`
            });
          }
        })
      ],
      onOpenChange(V) {
        V || t.suggestionMenus.closeMenu();
      },
      ...s
    }
  );
  return !g || !m || !(m != null && m.ignoreQueryLength) && r && (m.query.startsWith(" ") || m.query.length < r) ? null : /* @__PURE__ */ i("div", { ref: H, style: b, ...B(), children: /* @__PURE__ */ i(
    Zr,
    {
      query: m.query,
      closeMenu: u.closeMenu,
      clearQuery: u.clearQuery,
      getItems: a,
      suggestionMenuComponent: o || Er,
      onItemClick: d
    }
  ) });
}
const Ar = (e, t = 0.3) => {
  const n = Math.floor(e) + t, o = Math.ceil(e) - t;
  return e >= n && e <= o ? Math.round(e) : e < n ? Math.floor(e) : Math.ceil(e);
}, Gr = (e) => {
  const t = p(), n = N(!1), [o, r] = w(), l = f(
    (s) => {
      e.onMouseDown(), r({
        originalContent: e.block.content,
        originalCroppedContent: {
          rows: e.editor.tableHandles.cropEmptyRowsOrColumns(
            e.block,
            e.orientation === "addOrRemoveColumns" ? "columns" : "rows"
          )
        },
        startPos: e.orientation === "addOrRemoveColumns" ? s.clientX : s.clientY
      }), n.current = !1, s.preventDefault();
    },
    [e]
  ), c = f(() => {
    n.current || e.editor.updateBlock(e.block, {
      type: "table",
      content: {
        ...e.block.content,
        rows: e.orientation === "addOrRemoveColumns" ? e.editor.tableHandles.addRowsOrColumns(
          e.block,
          "columns",
          1
        ) : e.editor.tableHandles.addRowsOrColumns(
          e.block,
          "rows",
          1
        )
      }
    });
  }, [e.block, e.orientation, e.editor]);
  return x(() => {
    const s = (d) => {
      var H, b;
      if (!o)
        throw new Error("editingState is undefined");
      n.current = !0;
      const a = (e.orientation === "addOrRemoveColumns" ? d.clientX : d.clientY) - o.startPos, u = e.orientation === "addOrRemoveColumns" ? ((H = o.originalCroppedContent.rows[0]) == null ? void 0 : H.cells.length) ?? 0 : o.originalCroppedContent.rows.length, h = e.orientation === "addOrRemoveColumns" ? ((b = o.originalContent.rows[0]) == null ? void 0 : b.cells.length) ?? 0 : o.originalContent.rows.length, m = e.orientation === "addOrRemoveColumns" ? e.block.content.rows[0].cells.length : e.block.content.rows.length, g = h + Ar(
        a / (e.orientation === "addOrRemoveColumns" ? gn : fn),
        0.3
      );
      g >= u && g > 0 && g !== m && (e.editor.updateBlock(e.block, {
        type: "table",
        content: {
          ...e.block.content,
          rows: e.orientation === "addOrRemoveColumns" ? e.editor.tableHandles.addRowsOrColumns(
            {
              type: "table",
              content: o.originalCroppedContent
            },
            "columns",
            g - u
          ) : e.editor.tableHandles.addRowsOrColumns(
            {
              type: "table",
              content: o.originalCroppedContent
            },
            "rows",
            g - u
          )
        }
      }), e.block.content && e.editor.setTextCursorPosition(e.block));
    };
    return o && window.addEventListener("mousemove", s), () => {
      window.removeEventListener("mousemove", s);
    };
  }, [o, e.block, e.editor, e.orientation]), x(() => {
    const s = e.onMouseUp, d = () => {
      r(void 0), s();
    };
    return o && window.addEventListener("mouseup", d), () => {
      window.removeEventListener("mouseup", d);
    };
  }, [o, e.onMouseUp]), /* @__PURE__ */ i(
    t.TableHandle.ExtendButton,
    {
      className: _(
        "bn-extend-button",
        e.orientation === "addOrRemoveColumns" ? "bn-extend-button-add-remove-columns" : "bn-extend-button-add-remove-rows",
        o !== null ? "bn-extend-button-editing" : ""
      ),
      onClick: c,
      onMouseDown: l,
      children: e.children || /* @__PURE__ */ i(xo, { size: 18, "data-test": "extendButton" })
    }
  );
}, nt = (e) => {
  const t = p(), n = M(), r = C().tableHandles;
  return r ? /* @__PURE__ */ i(
    t.Generic.Menu.Item,
    {
      onClick: () => {
        r.addRowOrColumn(
          e.index,
          e.orientation === "row" ? { orientation: "row", side: e.side } : { orientation: "column", side: e.side }
        );
      },
      children: n.table_handle[`add_${e.side}_menuitem`]
    }
  ) : null;
}, Ur = (e) => {
  const t = p(), n = M(), r = C().tableHandles;
  return r ? /* @__PURE__ */ i(
    t.Generic.Menu.Item,
    {
      onClick: () => {
        r.removeRowOrColumn(e.index, e.orientation);
      },
      children: e.orientation === "row" ? n.table_handle.delete_row_menuitem : n.table_handle.delete_column_menuitem
    }
  ) : null;
}, zr = (e) => {
  const t = p(), n = M(), o = C(), r = o.tableHandles, l = y(() => !r || !e.block ? [] : e.orientation === "row" ? r.getCellsAtRowHandle(e.block, e.index) : r.getCellsAtColumnHandle(e.block, e.index), [e.block, e.index, e.orientation, r]), c = (d, a) => {
    const u = e.block.content.rows.map((h) => ({
      ...h,
      cells: h.cells.map((m) => K(m))
    }));
    l.forEach(({ row: h, col: m }) => {
      a === "text" ? u[h].cells[m].props.textColor = d : u[h].cells[m].props.backgroundColor = d;
    }), o.updateBlock(e.block, {
      type: "table",
      content: {
        ...e.block.content,
        rows: u
      }
    }), o.setTextCursorPosition(e.block);
  };
  if (!l || !l[0] || !r || o.settings.tables.cellTextColor === !1 && o.settings.tables.cellBackgroundColor === !1)
    return null;
  const s = K(l[0].cell);
  return /* @__PURE__ */ v(t.Generic.Menu.Root, { position: "right", sub: !0, children: [
    /* @__PURE__ */ i(t.Generic.Menu.Trigger, { sub: !0, children: /* @__PURE__ */ i(
      t.Generic.Menu.Item,
      {
        className: "bn-menu-item",
        subTrigger: !0,
        children: e.children || n.drag_handle.colors_menuitem
      }
    ) }),
    /* @__PURE__ */ i(
      t.Generic.Menu.Dropdown,
      {
        sub: !0,
        className: "bn-menu-dropdown bn-color-picker-dropdown",
        children: /* @__PURE__ */ i(
          be,
          {
            iconSize: 18,
            text: o.settings.tables.cellTextColor ? {
              // All cells have the same text color
              color: l.every(
                ({ cell: d }) => X(d) && d.props.textColor === s.props.textColor
              ) ? s.props.textColor : "default",
              setColor: (d) => {
                c(d, "text");
              }
            } : void 0,
            background: o.settings.tables.cellBackgroundColor ? {
              color: l.every(
                ({ cell: d }) => X(d) && d.props.backgroundColor === s.props.backgroundColor
              ) ? s.props.backgroundColor : "default",
              setColor: (d) => c(d, "background")
            } : void 0
          }
        )
      }
    )
  ] });
}, jr = (e) => {
  const t = p(), n = M(), o = C();
  if (!o.tableHandles || e.index !== 0 || e.orientation !== "row" || !o.settings.tables.headers)
    return null;
  const l = !!e.block.content.headerRows;
  return /* @__PURE__ */ i(
    t.Generic.Menu.Item,
    {
      className: "bn-menu-item",
      checked: l,
      onClick: () => {
        const c = o.getBlock(e.block.id);
        c && o.updateBlock(c, {
          ...c,
          content: {
            ...c.content,
            headerRows: l ? void 0 : 1
          }
        });
      },
      children: n.drag_handle.header_row_menuitem
    }
  );
}, Wr = (e) => {
  const t = p(), n = M(), o = C();
  if (!o.tableHandles || e.index !== 0 || e.orientation !== "column" || !o.settings.tables.headers)
    return null;
  const l = !!e.block.content.headerCols;
  return /* @__PURE__ */ i(
    t.Generic.Menu.Item,
    {
      className: "bn-menu-item",
      checked: l,
      onClick: () => {
        const c = o.getBlock(e.block.id);
        c && o.updateBlock(c, {
          ...c,
          content: {
            ...c.content,
            headerCols: l ? void 0 : 1
          }
        });
      },
      children: n.drag_handle.header_column_menuitem
    }
  );
}, qr = (e) => {
  const t = p();
  return /* @__PURE__ */ i(t.Generic.Menu.Dropdown, { className: "bn-table-handle-menu", children: e.children || /* @__PURE__ */ v(S, { children: [
    /* @__PURE__ */ i(
      Ur,
      {
        orientation: e.orientation,
        block: e.block,
        index: e.index
      }
    ),
    /* @__PURE__ */ i(
      nt,
      {
        orientation: e.orientation,
        block: e.block,
        index: e.index,
        side: e.orientation === "row" ? "above" : "left"
      }
    ),
    /* @__PURE__ */ i(
      nt,
      {
        orientation: e.orientation,
        block: e.block,
        index: e.index,
        side: e.orientation === "row" ? "below" : "right"
      }
    ),
    /* @__PURE__ */ i(
      jr,
      {
        orientation: e.orientation,
        block: e.block,
        index: e.index
      }
    ),
    /* @__PURE__ */ i(
      Wr,
      {
        orientation: e.orientation,
        block: e.block,
        index: e.index
      }
    ),
    /* @__PURE__ */ i(
      zr,
      {
        orientation: e.orientation,
        block: e.block,
        index: e.index
      }
    )
  ] }) });
}, $r = (e) => {
  const t = p(), [n, o] = w(!1), r = e.tableHandleMenu || qr, l = y(() => {
    const c = e.editor.tableHandles;
    return !c || !e.block || e.block.type !== "table" ? !1 : e.orientation === "column" ? c.getCellsAtColumnHandle(e.block, e.index).every(({ cell: s }) => lt(s) === 1) : c.getCellsAtRowHandle(e.block, e.index).every(({ cell: s }) => ct(s) === 1);
  }, [e.block, e.editor.tableHandles, e.index, e.orientation]);
  return /* @__PURE__ */ v(
    t.Generic.Menu.Root,
    {
      onOpenChange: (c) => {
        c ? (e.freezeHandles(), e.hideOtherSide()) : (e.unfreezeHandles(), e.showOtherSide(), e.editor.focus());
      },
      position: "right",
      children: [
        /* @__PURE__ */ i(t.Generic.Menu.Trigger, { children: /* @__PURE__ */ i(
          t.TableHandle.Root,
          {
            className: _(
              "bn-table-handle",
              n ? "bn-table-handle-dragging" : "",
              l ? "" : "bn-table-handle-not-draggable"
            ),
            draggable: l,
            onDragStart: (c) => {
              o(!0), e.dragStart(c);
            },
            onDragEnd: () => {
              e.dragEnd(), o(!1);
            },
            style: e.orientation === "column" ? { transform: "rotate(0.25turn)" } : void 0,
            children: e.children || /* @__PURE__ */ i(Nt, { size: 24, "data-test": "tableHandle" })
          }
        ) }),
        he(
          /* @__PURE__ */ i(
            r,
            {
              orientation: e.orientation,
              block: e.block,
              index: e.index
            }
          ),
          e.menuContainer
        )
      ]
    }
  );
};
function ot(e, t, n) {
  const { refs: o, update: r, context: l, floatingStyles: c } = Le({
    open: t,
    placement: e === "addOrRemoveColumns" ? "right" : "bottom",
    middleware: [
      Re({
        apply({ rects: a, elements: u }) {
          Object.assign(
            u.floating.style,
            e === "addOrRemoveColumns" ? {
              height: `${a.reference.height}px`
            } : {
              width: `${a.reference.width}px`
            }
          );
        }
      })
    ]
  }), { isMounted: s, styles: d } = _e(l);
  return x(() => {
    r();
  }, [n, r]), x(() => {
    n !== null && o.setReference({
      getBoundingClientRect: () => n
    });
  }, [e, n, o]), y(
    () => ({
      isMounted: s,
      ref: o.setFloating,
      style: {
        display: "flex",
        ...d,
        ...c
      }
    }),
    [c, s, o.setFloating, d]
  );
}
function Kr(e, t, n) {
  const o = ot(
    "addOrRemoveRows",
    t,
    n
  ), r = ot(
    "addOrRemoveColumns",
    e,
    n
  );
  return y(
    () => ({
      addOrRemoveRowsButton: o,
      addOrRemoveColumnsButton: r
    }),
    [r, o]
  );
}
function Xr(e, t, n) {
  return n && n.draggedCellOrientation === "row" ? new DOMRect(
    t.x,
    n.mousePos,
    t.width,
    0
  ) : new DOMRect(
    t.x,
    e.y,
    t.width,
    e.height
  );
}
function Yr(e, t, n) {
  return n && n.draggedCellOrientation === "col" ? new DOMRect(
    n.mousePos,
    t.y,
    0,
    t.height
  ) : new DOMRect(
    e.x,
    t.y,
    e.width,
    t.height
  );
}
function Jr(e) {
  return new DOMRect(
    e.x,
    e.y,
    e.width,
    0
  );
}
function ve(e, t, n, o, r) {
  const { refs: l, update: c, context: s, floatingStyles: d } = Le({
    open: t,
    placement: e === "row" ? "left" : e === "col" ? "top" : "bottom-end",
    middleware: [
      A(
        e === "row" ? -10 : e === "col" ? -12 : { mainAxis: 1, crossAxis: -1 }
      )
    ]
  }), { isMounted: a, styles: u } = _e(s);
  return x(() => {
    c();
  }, [n, o, c]), x(() => {
    n === null || o === null || // Ignore cell handle when dragging
    r && e === "cell" || l.setReference({
      getBoundingClientRect: () => (e === "row" ? Xr : e === "col" ? Yr : Jr)(n, o, r)
    });
  }, [r, e, n, o, l]), y(
    () => ({
      isMounted: a,
      ref: l.setFloating,
      style: {
        display: "flex",
        ...u,
        ...d
      }
    }),
    [d, a, l.setFloating, u]
  );
}
function Qr(e, t, n, o) {
  const r = ve(
    "row",
    e,
    t,
    n,
    o
  ), l = ve(
    "col",
    e,
    t,
    n,
    o
  ), c = ve(
    "cell",
    e,
    t,
    n,
    o
  );
  return y(
    () => ({
      rowHandle: r,
      colHandle: l,
      cellHandle: c
    }),
    [l, r, c]
  );
}
const ei = (e) => {
  var c, s;
  const t = p(), n = M(), o = C(), r = (d, a) => {
    const u = e.block.content.rows.map((h) => ({
      ...h,
      cells: h.cells.map((m) => K(m))
    }));
    a === "text" ? u[e.rowIndex].cells[e.colIndex].props.textColor = d : u[e.rowIndex].cells[e.colIndex].props.backgroundColor = d, o.updateBlock(e.block, {
      type: "table",
      content: {
        ...e.block.content,
        rows: u
      }
    }), o.setTextCursorPosition(e.block);
  }, l = (s = (c = e.block.content.rows[e.rowIndex]) == null ? void 0 : c.cells) == null ? void 0 : s[e.colIndex];
  return !l || o.settings.tables.cellTextColor === !1 && o.settings.tables.cellBackgroundColor === !1 ? null : /* @__PURE__ */ v(t.Generic.Menu.Root, { position: "right", sub: !0, children: [
    /* @__PURE__ */ i(t.Generic.Menu.Trigger, { sub: !0, children: /* @__PURE__ */ i(
      t.Generic.Menu.Item,
      {
        className: "bn-menu-item",
        subTrigger: !0,
        children: e.children || n.drag_handle.colors_menuitem
      }
    ) }),
    /* @__PURE__ */ i(
      t.Generic.Menu.Dropdown,
      {
        sub: !0,
        className: "bn-menu-dropdown bn-color-picker-dropdown",
        children: /* @__PURE__ */ i(
          be,
          {
            iconSize: 18,
            text: o.settings.tables.cellTextColor ? {
              color: X(l) ? l.props.textColor : "default",
              setColor: (d) => r(d, "text")
            } : void 0,
            background: o.settings.tables.cellBackgroundColor ? {
              color: X(l) ? l.props.backgroundColor : "default",
              setColor: (d) => r(d, "background")
            } : void 0
          }
        )
      }
    )
  ] });
}, ti = (e) => {
  var l, c;
  const t = p(), n = M(), o = C(), r = (c = (l = e.block.content.rows[e.rowIndex]) == null ? void 0 : l.cells) == null ? void 0 : c[e.colIndex];
  return !r || !X(r) || ct(r) === 1 && lt(r) === 1 || !o.settings.tables.splitCells ? null : /* @__PURE__ */ i(
    t.Generic.Menu.Item,
    {
      onClick: () => {
        var s;
        (s = o.tableHandles) == null || s.splitCell({
          row: e.rowIndex,
          col: e.colIndex
        });
      },
      children: n.table_handle.split_cell_menuitem
    }
  );
}, ni = (e) => {
  const t = p();
  return /* @__PURE__ */ i(
    t.Generic.Menu.Dropdown,
    {
      className: "bn-menu-dropdown bn-drag-handle-menu",
      children: e.children || /* @__PURE__ */ v(S, { children: [
        /* @__PURE__ */ i(
          ti,
          {
            block: e.block,
            rowIndex: e.rowIndex,
            colIndex: e.colIndex
          }
        ),
        /* @__PURE__ */ i(
          ei,
          {
            block: e.block,
            rowIndex: e.rowIndex,
            colIndex: e.colIndex
          }
        )
      ] })
    }
  );
}, oi = (e) => {
  const t = p(), n = e.tableCellMenu || ni;
  return !e.editor.settings.tables.splitCells && !e.editor.settings.tables.cellBackgroundColor && !e.editor.settings.tables.cellTextColor ? null : /* @__PURE__ */ v(
    t.Generic.Menu.Root,
    {
      onOpenChange: (o) => {
        o ? e.freezeHandles() : (e.unfreezeHandles(), e.editor.focus());
      },
      position: "right",
      children: [
        /* @__PURE__ */ i(t.Generic.Menu.Trigger, { children: /* @__PURE__ */ i(t.Generic.Menu.Button, { className: "bn-table-cell-handle", children: e.children || /* @__PURE__ */ i(kr, { size: 12, "data-test": "tableCellHandle" }) }) }),
        he(
          /* @__PURE__ */ i(
            n,
            {
              block: e.block,
              rowIndex: e.rowIndex,
              colIndex: e.colIndex
            }
          ),
          e.menuContainer
        )
      ]
    }
  );
}, ri = (e) => {
  var q, R;
  const t = C(), [n, o] = w(null);
  if (!t.tableHandles)
    throw new Error(
      "TableHandlesController can only be used when BlockNote editor schema contains table block"
    );
  const r = {
    rowDragStart: t.tableHandles.rowDragStart,
    colDragStart: t.tableHandles.colDragStart,
    dragEnd: t.tableHandles.dragEnd,
    freezeHandles: t.tableHandles.freezeHandles,
    unfreezeHandles: t.tableHandles.unfreezeHandles
  }, { freezeHandles: l, unfreezeHandles: c } = r, s = f(() => {
    l(), I(!0), V(!0);
  }, [l]), d = f(() => {
    c(), I(!1), V(!1);
  }, [c]), a = Z(
    t.tableHandles.onUpdate.bind(t.tableHandles)
  ), u = y(() => {
    var F, te;
    return a != null && a.draggingState ? {
      draggedCellOrientation: (F = a == null ? void 0 : a.draggingState) == null ? void 0 : F.draggedCellOrientation,
      mousePos: (te = a == null ? void 0 : a.draggingState) == null ? void 0 : te.mousePos
    } : void 0;
  }, [
    a == null ? void 0 : a.draggingState,
    (q = a == null ? void 0 : a.draggingState) == null ? void 0 : q.draggedCellOrientation,
    (R = a == null ? void 0 : a.draggingState) == null ? void 0 : R.mousePos
  ]), { rowHandle: h, colHandle: m, cellHandle: g } = Qr(
    (a == null ? void 0 : a.show) || !1,
    (a == null ? void 0 : a.referencePosCell) || null,
    (a == null ? void 0 : a.referencePosTable) || null,
    u
  ), { addOrRemoveColumnsButton: H, addOrRemoveRowsButton: b } = Kr(
    (a == null ? void 0 : a.showAddOrRemoveColumnsButton) || !1,
    (a == null ? void 0 : a.showAddOrRemoveRowsButton) || !1,
    (a == null ? void 0 : a.referencePosTable) || null
  ), [B, V] = w(!1), [T, I] = w(!1);
  if (!a)
    return null;
  const z = e.tableHandle || $r, j = e.extendButton || Gr, O = e.tableCellHandle || oi;
  return /* @__PURE__ */ v(S, { children: [
    /* @__PURE__ */ i("div", { ref: o }),
    /* @__PURE__ */ v(en, { root: a.widgetContainer, children: [
      !B && n && h.isMounted && a.rowIndex !== void 0 && /* @__PURE__ */ i("div", { ref: h.ref, style: h.style, children: /* @__PURE__ */ i(
        z,
        {
          editor: t,
          orientation: "row",
          showOtherSide: () => I(!1),
          hideOtherSide: () => I(!0),
          index: a.rowIndex,
          block: a.block,
          dragStart: r.rowDragStart,
          dragEnd: r.dragEnd,
          freezeHandles: r.freezeHandles,
          unfreezeHandles: r.unfreezeHandles,
          menuContainer: n
        }
      ) }),
      !T && n && m.isMounted && a.colIndex !== void 0 && /* @__PURE__ */ i("div", { ref: m.ref, style: m.style, children: /* @__PURE__ */ i(
        z,
        {
          editor: t,
          orientation: "column",
          showOtherSide: () => V(!1),
          hideOtherSide: () => V(!0),
          index: a.colIndex,
          block: a.block,
          dragStart: r.colDragStart,
          dragEnd: r.dragEnd,
          freezeHandles: r.freezeHandles,
          unfreezeHandles: r.unfreezeHandles,
          menuContainer: n
        }
      ) }),
      n && g.isMounted && a.colIndex !== void 0 && a.rowIndex !== void 0 && /* @__PURE__ */ i("div", { ref: g.ref, style: g.style, children: /* @__PURE__ */ i(
        O,
        {
          editor: t,
          block: a.block,
          rowIndex: a.rowIndex,
          colIndex: a.colIndex,
          menuContainer: n,
          freezeHandles: r.freezeHandles,
          unfreezeHandles: r.unfreezeHandles
        }
      ) }),
      /* @__PURE__ */ i(
        "div",
        {
          ref: b.ref,
          style: b.style,
          children: /* @__PURE__ */ i(
            j,
            {
              editor: t,
              orientation: "addOrRemoveRows",
              block: a.block,
              onMouseDown: s,
              onMouseUp: d
            }
          )
        }
      ),
      /* @__PURE__ */ i(
        "div",
        {
          ref: H.ref,
          style: H.style,
          children: /* @__PURE__ */ i(
            j,
            {
              editor: t,
              orientation: "addOrRemoveColumns",
              block: a.block,
              onMouseDown: s,
              onMouseUp: d
            }
          )
        }
      )
    ] })
  ] });
};
function ii(e) {
  const t = C();
  if (!t)
    throw new Error(
      "BlockNoteDefaultUI must be used within a BlockNoteContext.Provider"
    );
  return /* @__PURE__ */ v(S, { children: [
    e.formattingToolbar !== !1 && /* @__PURE__ */ i(ur, {}),
    e.linkToolbar !== !1 && /* @__PURE__ */ i(br, {}),
    e.slashMenu !== !1 && /* @__PURE__ */ i(Fr, { triggerCharacter: "/" }),
    e.emojiPicker !== !1 && /* @__PURE__ */ i(
      Rr,
      {
        triggerCharacter: ":",
        columns: 10,
        minQueryLength: 2
      }
    ),
    e.sideMenu !== !1 && /* @__PURE__ */ i(Br, {}),
    t.filePanel && e.filePanel !== !1 && /* @__PURE__ */ i(Go, {}),
    t.tableHandles && e.tableHandles !== !1 && /* @__PURE__ */ i(ri, {}),
    t.comments && e.comments !== !1 && /* @__PURE__ */ v(S, { children: [
      /* @__PURE__ */ i($n, {}),
      /* @__PURE__ */ i(Oo, {})
    ] })
  ] });
}
const li = () => {
  const e = y(
    () => {
      var c;
      return (c = window.matchMedia) == null ? void 0 : c.call(window, "(prefers-color-scheme: dark)");
    },
    []
  ), t = y(
    () => {
      var c;
      return (c = window.matchMedia) == null ? void 0 : c.call(window, "(prefers-color-scheme: light)");
    },
    []
  ), n = e == null ? void 0 : e.matches, o = t == null ? void 0 : t.matches, [r, l] = w(n ? "dark" : o ? "light" : "no-preference");
  return x(() => {
    l(n ? "dark" : o ? "light" : "no-preference");
  }, [n, o]), x(() => {
    if (typeof (e == null ? void 0 : e.addEventListener) == "function") {
      const c = ({ matches: d }) => d && l("dark"), s = ({ matches: d }) => d && l("light");
      return e == null || e.addEventListener("change", c), t == null || t.addEventListener("change", s), () => {
        e == null || e.removeEventListener("change", c), t == null || t.removeEventListener("change", s);
      };
    } else {
      const c = () => l(
        e.matches ? "dark" : t.matches ? "light" : "no-preference"
      );
      return e == null || e.addEventListener("change", c), t == null || t.addEventListener("change", c), () => {
        e == null || e.removeEventListener("change", c), t == null || t.removeEventListener("change", c);
      };
    }
  }, [e, t]), typeof window.matchMedia != "function", r;
}, Dt = Be(void 0);
function ci() {
  return Te(Dt);
}
function ai() {
  const e = /* @__PURE__ */ new Set();
  let t = {};
  return {
    /**
     * Subscribe to the editor instance's changes.
     */
    subscribe(n) {
      return e.add(n), () => {
        e.delete(n);
      };
    },
    getSnapshot() {
      return t;
    },
    getServerSnapshot() {
      return t;
    },
    /**
     * Adds a new NodeView Renderer to the editor.
     */
    setRenderer(n, o) {
      t = {
        ...t,
        [n]: he(o.reactElement, o.element, n)
      }, e.forEach((r) => r());
    },
    /**
     * Removes a NodeView Renderer from the editor.
     */
    removeRenderer(n) {
      const o = { ...t };
      delete o[n], t = o, e.forEach((r) => r());
    }
  };
}
const si = ({
  contentComponent: e
}) => {
  const t = Se(
    e.subscribe,
    e.getSnapshot,
    e.getServerSnapshot
  );
  return /* @__PURE__ */ i(S, { children: Object.values(t) });
}, di = Kt((e, t) => {
  const [n, o] = w();
  return Xt(t, () => (r, l) => {
    ut(() => {
      o({ node: r, container: l });
    }), o(void 0);
  }, []), /* @__PURE__ */ i(S, { children: n && he(n.node, n.container) });
}), rt = () => {
};
function ui(e, t) {
  const {
    editor: n,
    className: o,
    theme: r,
    children: l,
    editable: c,
    onSelectionChange: s,
    onChange: d,
    formattingToolbar: a,
    linkToolbar: u,
    slashMenu: h,
    emojiPicker: m,
    sideMenu: g,
    filePanel: H,
    tableHandles: b,
    comments: B,
    autoFocus: V,
    renderEditor: T = !n.headless,
    ...I
  } = e, [z, j] = w(), O = D(), q = li(), R = (O == null ? void 0 : O.colorSchemePreference) || q, F = r || (R === "dark" ? "dark" : "light");
  ee(d || rt, n), ge(s || rt, n), x(() => {
    n.isEditable = c !== !1;
  }, [c, n]);
  const te = f(
    (zt) => {
      n.elementRenderer = zt;
    },
    [n]
  ), At = y(() => ({
    ...O,
    editor: n,
    setContentEditableProps: j
  }), [O, n]), Gt = {
    formattingToolbar: a,
    linkToolbar: u,
    slashMenu: h,
    emojiPicker: m,
    sideMenu: g,
    filePanel: H,
    tableHandles: b,
    comments: B
  }, Ut = {
    autoFocus: V,
    contentEditableProps: z
  };
  return /* @__PURE__ */ i(ft.Provider, { value: At, children: /* @__PURE__ */ v(
    Dt.Provider,
    {
      value: {
        editorProps: Ut,
        defaultUIProps: Gt
      },
      children: [
        /* @__PURE__ */ i(di, { ref: te }),
        /* @__PURE__ */ i(
          mi,
          {
            className: o,
            renderEditor: T,
            editorColorScheme: F,
            ref: t,
            ...I,
            children: l
          }
        )
      ]
    }
  ) });
}
const mi = P.forwardRef(({ className: e, renderEditor: t, editorColorScheme: n, children: o, ...r }, l) => /* @__PURE__ */ i(
  "div",
  {
    className: _("bn-container", n, e),
    "data-color-scheme": n,
    ...r,
    ref: l,
    children: t ? /* @__PURE__ */ i(hi, { children: o }) : o
  }
)), Yi = P.forwardRef(ui), hi = (e) => {
  const t = ci(), n = C(), o = y(() => ai(), []), r = f(
    (l) => {
      n.mount(l, o);
    },
    [n, o]
  );
  return /* @__PURE__ */ v(S, { children: [
    /* @__PURE__ */ i(si, { contentComponent: o }),
    /* @__PURE__ */ i(gi, { ...t.editorProps, ...e, mount: r }),
    /* @__PURE__ */ i(ii, { ...t.defaultUIProps }),
    e.children
  ] });
}, gi = (e) => {
  const { autoFocus: t, mount: n, contentEditableProps: o } = e;
  return /* @__PURE__ */ i(
    "div",
    {
      "aria-autocomplete": "list",
      "aria-haspopup": "listbox",
      "data-bn-autofocus": t,
      ref: n,
      ...o
    }
  );
};
function de(e, t) {
  let n;
  const o = document.createElement("div");
  let r;
  if (t != null && t.elementRenderer)
    t.elementRenderer(
      e((d) => n = d || void 0),
      o
    );
  else {
    if (!(t != null && t.headless))
      throw new Error(
        "elementRenderer not available, expected headless editor"
      );
    r = An(o), ut(() => {
      r.render(e((d) => n = d || void 0));
    });
  }
  if (!o.childElementCount)
    return console.warn("ReactInlineContentSpec: renderHTML() failed"), {
      dom: document.createElement("span")
    };
  n == null || n.setAttribute("data-tmp-find", "true");
  const l = o.cloneNode(!0), c = l.firstElementChild, s = l.querySelector(
    "[data-tmp-find]"
  );
  return s == null || s.removeAttribute("data-tmp-find"), r == null || r.unmount(), {
    dom: c,
    contentDOM: s || void 0
  };
}
function He(e) {
  var t;
  return (
    // Creates `blockContent` element
    /* @__PURE__ */ i(
      gt,
      {
        onDragOver: (n) => n.preventDefault(),
        ...Object.fromEntries(
          Object.entries(e.domAttributes || {}).filter(
            ([n]) => n !== "class"
          )
        ),
        className: _(
          "bn-block-content",
          ((t = e.domAttributes) == null ? void 0 : t.class) || ""
        ),
        "data-content-type": e.blockType,
        ...Object.fromEntries(
          Object.entries(e.blockProps).filter(([n, o]) => {
            const r = e.propSchema[n];
            return !vn.includes(n) && o !== r.default;
          }).map(([n, o]) => [st(n), o])
        ),
        "data-file-block": e.isFileBlock === !0 || void 0,
        children: e.children
      }
    )
  );
}
function Ce(e, t) {
  const n = Ee({
    name: e.type,
    content: e.content === "inline" ? "inline*" : "",
    group: "blockContent",
    selectable: e.isSelectable ?? !0,
    isolating: !0,
    addAttributes() {
      return at(e.propSchema);
    },
    parseHTML() {
      return kn(e, t.parse);
    },
    renderHTML({ HTMLAttributes: o }) {
      const r = document.createElement("div");
      return pn(
        {
          dom: r,
          contentDOM: e.content === "inline" ? r : void 0
        },
        e.type,
        {},
        e.propSchema,
        e.isFileBlock,
        o
      );
    },
    addNodeView() {
      return (o) => {
        const r = mt(
          (l) => {
            var h;
            const c = this.options.editor, s = bn(
              l.getPos,
              c,
              this.editor,
              e.type
            ), d = ((h = this.options.domAttributes) == null ? void 0 : h.blockContent) || {}, a = ht().nodeViewContentRef;
            if (!a)
              throw new Error("nodeViewContentRef is not set");
            const u = t.render;
            return /* @__PURE__ */ i(
              He,
              {
                blockType: s.type,
                blockProps: s.props,
                propSchema: e.propSchema,
                isFileBlock: e.isFileBlock,
                domAttributes: d,
                children: /* @__PURE__ */ i(
                  u,
                  {
                    block: s,
                    editor: c,
                    contentRef: (m) => {
                      a(m), m && (m.className = _(
                        "bn-inline-content",
                        m.className
                      ));
                    }
                  }
                )
              }
            );
          },
          {
            className: "bn-react-node-view-renderer"
          }
        )(o);
        return e.isSelectable === !1 && Cn(r, this.editor), r;
      };
    }
  });
  return wn(e, {
    node: n,
    toInternalHTML: (o, r) => {
      var d;
      const l = ((d = n.options.domAttributes) == null ? void 0 : d.blockContent) || {}, c = t.render;
      return de(
        (a) => /* @__PURE__ */ i(
          He,
          {
            blockType: o.type,
            blockProps: o.props,
            propSchema: e.propSchema,
            domAttributes: l,
            children: /* @__PURE__ */ i(
              c,
              {
                block: o,
                editor: r,
                contentRef: (u) => {
                  a(u), u && (u.className = _(
                    "bn-inline-content",
                    u.className
                  ));
                }
              }
            )
          }
        ),
        r
      );
    },
    toExternalHTML: (o, r) => {
      var d;
      const l = ((d = n.options.domAttributes) == null ? void 0 : d.blockContent) || {}, c = t.toExternalHTML || t.render;
      return de((a) => /* @__PURE__ */ i(
        He,
        {
          blockType: o.type,
          blockProps: o.props,
          propSchema: e.propSchema,
          domAttributes: l,
          children: /* @__PURE__ */ i(
            c,
            {
              block: o,
              editor: r,
              contentRef: (u) => {
                a(u), u && (u.className = _(
                  "bn-inline-content",
                  u.className
                ));
              }
            }
          )
        }
      ), r);
    }
  });
}
function Oe(e) {
  const t = C(), [n, o] = w("loading"), [r, l] = w();
  if (x(() => {
    let c = !0;
    return (async () => {
      let s = "";
      o("loading");
      try {
        s = t.resolveFileUrl ? await t.resolveFileUrl(e) : e;
      } catch {
        o("error");
        return;
      }
      c && (o("loaded"), l(s));
    })(), () => {
      c = !1;
    };
  }, [t, e]), n !== "loaded")
    return {
      loadingState: n
    };
  if (!r)
    throw new Error("Finished fetching file but did not get download URL.");
  return {
    loadingState: n,
    downloadUrl: r
  };
}
const Fe = (e) => /* @__PURE__ */ v("figure", { children: [
  e.children,
  /* @__PURE__ */ i("figcaption", { children: e.caption })
] });
function fi(e) {
  const t = C();
  x(() => t.onUploadEnd(e), [e, t]);
}
function bi(e) {
  const t = C();
  x(() => t.onUploadStart(e), [e, t]);
}
function Ot(e) {
  const [t, n] = w(!1);
  return bi((o) => {
    o === e && n(!0);
  }), fi((o) => {
    o === e && n(!1);
  }), t;
}
const Ci = (e) => {
  const t = M(), n = f(
    (r) => {
      r.preventDefault();
    },
    []
  ), o = f(() => {
    e.editor.transact(
      (r) => r.setMeta(e.editor.filePanel.plugins[0], {
        block: e.block
      })
    );
  }, [e.block, e.editor]);
  return /* @__PURE__ */ v(
    "div",
    {
      className: "bn-add-file-button",
      onMouseDown: n,
      onClick: o,
      children: [
        /* @__PURE__ */ i("div", { className: "bn-add-file-button-icon", children: e.buttonIcon || /* @__PURE__ */ i(Pe, { size: 24 }) }),
        /* @__PURE__ */ i("div", { className: "bn-add-file-button-text", children: e.buttonText || t.file_blocks.file.add_button_text })
      ]
    }
  );
}, pi = (e) => /* @__PURE__ */ v(
  "div",
  {
    className: "bn-file-name-with-icon",
    contentEditable: !1,
    draggable: !1,
    children: [
      /* @__PURE__ */ i("div", { className: "bn-file-icon", children: /* @__PURE__ */ i(Pe, { size: 24 }) }),
      /* @__PURE__ */ i("p", { className: "bn-file-name", children: e.block.props.name })
    ]
  }
), Ae = (e) => {
  const t = Ot(e.block.id);
  return /* @__PURE__ */ i(
    "div",
    {
      className: "bn-file-block-content-wrapper",
      onMouseEnter: e.onMouseEnter,
      onMouseLeave: e.onMouseLeave,
      style: e.style,
      children: t ? (
        // Show loader while a file is being uploaded.
        /* @__PURE__ */ i("div", { className: "bn-file-loading-preview", children: "Loading..." })
      ) : e.block.props.url === "" ? (
        // Show the add file button if the file has not been uploaded yet.
        /* @__PURE__ */ i(Ci, { ...e })
      ) : (
        // Show the file preview, or the file name and icon.
        /* @__PURE__ */ v(S, { children: [
          e.block.props.showPreview === !1 || !e.children ? (
            // Show file name and icon.
            /* @__PURE__ */ i(pi, { ...e })
          ) : (
            // Show preview.
            e.children
          ),
          e.block.props.caption && // Show the caption if there is one.
          /* @__PURE__ */ i("p", { className: "bn-file-caption", children: e.block.props.caption })
        ] })
      )
    }
  );
}, pe = (e) => /* @__PURE__ */ v("div", { children: [
  e.children,
  /* @__PURE__ */ i("p", { children: e.caption })
] }), ki = (e) => {
  const t = Oe(e.block.props.url);
  return /* @__PURE__ */ i(
    "audio",
    {
      className: "bn-audio",
      src: t.loadingState === "loading" ? e.block.props.url : t.downloadUrl,
      controls: !0,
      contentEditable: !1,
      draggable: !1
    }
  );
}, wi = (e) => {
  if (!e.block.props.url)
    return /* @__PURE__ */ i("p", { children: "Add audio" });
  const t = e.block.props.showPreview ? /* @__PURE__ */ i("audio", { src: e.block.props.url }) : /* @__PURE__ */ i("a", { href: e.block.props.url, children: e.block.props.name || e.block.props.url });
  return e.block.props.caption ? e.block.props.showPreview ? /* @__PURE__ */ i(Fe, { caption: e.block.props.caption, children: t }) : /* @__PURE__ */ i(pe, { caption: e.block.props.caption, children: t }) : t;
}, vi = (e) => /* @__PURE__ */ i(
  Ae,
  {
    ...e,
    buttonText: e.editor.dictionary.file_blocks.audio.add_button_text,
    buttonIcon: /* @__PURE__ */ i(St, { size: 24 }),
    children: /* @__PURE__ */ i(ki, { ...e })
  }
), Ji = Ce(Mn, {
  render: vi,
  parse: Hn,
  toExternalHTML: wi
}), Hi = (e) => {
  if (!e.block.props.url)
    return /* @__PURE__ */ i("p", { children: "Add file" });
  const t = /* @__PURE__ */ i("a", { href: e.block.props.url, children: e.block.props.name || e.block.props.url });
  return e.block.props.caption ? /* @__PURE__ */ i(pe, { caption: e.block.props.caption, children: t }) : t;
}, Mi = (e) => /* @__PURE__ */ i(Ae, { ...e }), Qi = Ce(xn, {
  render: Mi,
  parse: yn,
  toExternalHTML: Hi
}), Ft = (e) => {
  const [t, n] = w(void 0), [o, r] = w(
    e.block.props.previewWidth
  ), [l, c] = w(!1), s = N(null);
  x(() => {
    const g = (b) => {
      var T, I;
      let B;
      e.block.props.textAlignment === "center" ? t.handleUsed === "left" ? B = t.initialWidth + (t.initialClientX - b.clientX) * 2 : B = t.initialWidth + (b.clientX - t.initialClientX) * 2 : t.handleUsed === "left" ? B = t.initialWidth + t.initialClientX - b.clientX : B = t.initialWidth + b.clientX - t.initialClientX, r(
        Math.min(
          Math.max(B, 64),
          ((I = (T = e.editor.domElement) == null ? void 0 : T.firstElementChild) == null ? void 0 : I.clientWidth) || Number.MAX_VALUE
        )
      );
    }, H = () => {
      n(void 0), e.editor.updateBlock(e.block, {
        props: {
          previewWidth: o
        }
      });
    };
    return t && (window.addEventListener("mousemove", g), window.addEventListener("mouseup", H)), () => {
      window.removeEventListener("mousemove", g), window.removeEventListener("mouseup", H);
    };
  }, [e, t, o]);
  const d = f(() => {
    e.editor.isEditable && c(!0);
  }, [e.editor.isEditable]), a = f(() => {
    c(!1);
  }, []), u = f(
    (g) => {
      g.preventDefault(), n({
        handleUsed: "left",
        initialWidth: s.current.clientWidth,
        initialClientX: g.clientX
      });
    },
    []
  ), h = f(
    (g) => {
      g.preventDefault(), n({
        handleUsed: "right",
        initialWidth: s.current.clientWidth,
        initialClientX: g.clientX
      });
    },
    []
  ), m = Ot(e.block.id);
  return /* @__PURE__ */ i(
    Ae,
    {
      ...e,
      onMouseEnter: d,
      onMouseLeave: a,
      style: e.block.props.url && !m && e.block.props.showPreview ? {
        width: o ? `${o}px` : "fit-content"
      } : void 0,
      children: /* @__PURE__ */ v("div", { className: "bn-visual-media-wrapper", ref: s, children: [
        e.children,
        (l || t) && /* @__PURE__ */ v(S, { children: [
          /* @__PURE__ */ i(
            "div",
            {
              className: "bn-resize-handle",
              style: { left: "4px" },
              onMouseDown: u
            }
          ),
          /* @__PURE__ */ i(
            "div",
            {
              className: "bn-resize-handle",
              style: { right: "4px" },
              onMouseDown: h
            }
          )
        ] })
      ] })
    }
  );
}, yi = (e) => {
  const t = Oe(e.block.props.url);
  return /* @__PURE__ */ i(
    "img",
    {
      className: "bn-visual-media",
      src: t.loadingState === "loading" ? e.block.props.url : t.downloadUrl,
      alt: e.block.props.caption || "BlockNote image",
      contentEditable: !1,
      draggable: !1
    }
  );
}, xi = (e) => {
  if (!e.block.props.url)
    return /* @__PURE__ */ i("p", { children: "Add image" });
  const t = e.block.props.showPreview ? /* @__PURE__ */ i(
    "img",
    {
      src: e.block.props.url,
      alt: e.block.props.name || e.block.props.caption || "BlockNote image",
      width: e.block.props.previewWidth
    }
  ) : /* @__PURE__ */ i("a", { href: e.block.props.url, children: e.block.props.name || e.block.props.url });
  return e.block.props.caption ? e.block.props.showPreview ? /* @__PURE__ */ i(Fe, { caption: e.block.props.caption, children: t }) : /* @__PURE__ */ i(pe, { caption: e.block.props.caption, children: t }) : t;
}, Vi = (e) => /* @__PURE__ */ i(
  Ft,
  {
    ...e,
    buttonText: e.editor.dictionary.file_blocks.image.add_button_text,
    buttonIcon: /* @__PURE__ */ i(Bt, { size: 24 }),
    children: /* @__PURE__ */ i(yi, { ...e })
  }
), el = Ce(Bn, {
  render: Vi,
  parse: Vn,
  toExternalHTML: xi
});
function Bi(e) {
  return k({ attr: { viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, child: [{ tag: "path", attr: { d: "M14 3v4a1 1 0 0 0 1 1h4" }, child: [] }, { tag: "path", attr: { d: "M19 18v1a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-1" }, child: [] }, { tag: "path", attr: { d: "M3 14h3m4.5 0h3m4.5 0h3" }, child: [] }, { tag: "path", attr: { d: "M5 10v-5a2 2 0 0 1 2 -2h7l5 5v2" }, child: [] }] })(e);
}
const Ti = {
  page_break: Bi
};
function tl(e) {
  return Tn(e).map((t) => {
    const n = Ti[t.key];
    return {
      ...t,
      icon: /* @__PURE__ */ i(n, { size: 18 })
    };
  });
}
const Si = (e) => {
  const t = Oe(e.block.props.url);
  return /* @__PURE__ */ i(
    "video",
    {
      className: "bn-visual-media",
      src: t.loadingState === "loading" ? e.block.props.url : t.downloadUrl,
      controls: !0,
      contentEditable: !1,
      draggable: !1
    }
  );
}, Li = (e) => {
  if (!e.block.props.url)
    return /* @__PURE__ */ i("p", { children: "Add video" });
  const t = e.block.props.showPreview ? /* @__PURE__ */ i("video", { src: e.block.props.url }) : /* @__PURE__ */ i("a", { href: e.block.props.url, children: e.block.props.name || e.block.props.url });
  return e.block.props.caption ? e.block.props.showPreview ? /* @__PURE__ */ i(Fe, { caption: e.block.props.caption, children: t }) : /* @__PURE__ */ i(pe, { caption: e.block.props.caption, children: t }) : t;
}, _i = (e) => /* @__PURE__ */ i(
  Ft,
  {
    ...e,
    buttonText: e.editor.dictionary.file_blocks.video.add_button_text,
    buttonIcon: /* @__PURE__ */ i(yo, { size: 24 }),
    children: /* @__PURE__ */ i(Si, { ...e })
  }
), nl = Ce(Ln, {
  render: _i,
  parse: Sn,
  toExternalHTML: Li
}), Ri = (e, t) => {
  if (t.type === "toggled")
    return !e;
  if (t.type === "childAdded")
    return !0;
  if (t.type === "lastChildRemoved")
    return !1;
  throw new dt(t);
}, ol = (e) => {
  const { block: t, editor: n, children: o, toggledState: r } = e, [l, c] = Yt(
    Ri,
    (r || ne).get(t)
  ), [s, d] = w(t.children.length), a = (m) => {
    (r || ne).set(
      n.getBlock(m),
      !l
    ), c({
      type: "toggled"
    });
  }, u = (m) => {
    (r || ne).set(m, !0), c({
      type: "childAdded"
    });
  }, h = (m) => {
    (r || ne).set(m, !1), c({
      type: "lastChildRemoved"
    });
  };
  return ee(() => {
    if ("isToggleable" in t.props && !t.props.isToggleable)
      return;
    const m = n.getBlock(t), g = m.children.length ?? 0;
    g > s ? l || u(m) : g === 0 && g < s && l && h(m), d(g);
  }), "isToggleable" in t.props && !t.props.isToggleable ? o : /* @__PURE__ */ v("div", { children: [
    /* @__PURE__ */ v("div", { className: "bn-toggle-wrapper", "data-show-children": l, children: [
      /* @__PURE__ */ i(
        "button",
        {
          className: "bn-toggle-button",
          onMouseDown: (m) => m.preventDefault(),
          onClick: () => a(n.getBlock(t)),
          children: /* @__PURE__ */ i(
            "svg",
            {
              xmlns: "http://www.w3.org/2000/svg",
              height: "1em",
              viewBox: "0 -960 960 960",
              width: "1em",
              fill: "currentcolor",
              children: /* @__PURE__ */ i("path", { d: "M472-480 332-620q-18-18-18-44t18-44q18-18 44-18t44 18l183 183q9 9 14 21t5 24q0 12-5 24t-14 21L420-252q-18 18-44 18t-44-18q-18-18-18-44t18-44l140-140Z" })
            }
          )
        }
      ),
      o
    ] }),
    l && s === 0 && /* @__PURE__ */ i(
      "button",
      {
        className: "bn-toggle-add-block-button",
        onClick: () => {
          const m = n.updateBlock(t, {
            // Single empty block with default type.
            children: [{}]
          });
          n.setTextCursorPosition(m.children[0].id, "end"), n.focus();
        },
        children: "Empty toggle. Click to add a block."
      }
    )
  ] });
}, rl = (e) => {
  const [t, n] = w("none"), o = N(null), r = C(), l = Z(
    r.formattingToolbar.onUpdate.bind(r.formattingToolbar)
  ), c = y(() => ({
    display: "flex",
    position: "fixed",
    bottom: 0,
    zIndex: 3e3,
    transform: t
  }), [t]);
  if (x(() => {
    const d = window.visualViewport;
    function a() {
      const u = document.body, h = d.offsetLeft, m = d.height - u.getBoundingClientRect().height + d.offsetTop;
      n(
        `translate(${h}px, ${m}px) scale(${1 / d.scale})`
      );
    }
    return window.visualViewport.addEventListener("scroll", a), window.visualViewport.addEventListener("resize", a), a(), () => {
      window.visualViewport.removeEventListener("scroll", a), window.visualViewport.removeEventListener("resize", a);
    };
  }, []), !l)
    return null;
  if (!l.show && o.current)
    return /* @__PURE__ */ i(
      "div",
      {
        ref: o,
        style: c,
        dangerouslySetInnerHTML: { __html: o.current.innerHTML }
      }
    );
  const s = e.formattingToolbar || It;
  return /* @__PURE__ */ i("div", { ref: o, style: c, children: /* @__PURE__ */ i(s, {}) });
}, Ei = P.memo(
  ({
    thread: e,
    selectedThreadId: t,
    editor: n,
    maxCommentsBeforeCollapse: o,
    referenceText: r
  }) => {
    const l = f(
      (s) => {
        var d;
        s.target.closest(".bn-action-toolbar") || (d = n.comments) == null || d.selectThread(e.id);
      },
      [n.comments, e.id]
    ), c = f(
      (s) => {
        var u;
        if (!s.relatedTarget || s.relatedTarget.closest(".bn-action-toolbar"))
          return;
        const d = s.target instanceof Node ? s.target : null, a = s.relatedTarget instanceof Node ? s.relatedTarget.closest(".bn-thread") : null;
        (!d || !a || !a.contains(d)) && ((u = n.comments) == null || u.selectThread(void 0));
      },
      [n.comments]
    );
    return /* @__PURE__ */ i(
      Lt,
      {
        thread: e,
        selected: e.id === t,
        referenceText: r,
        maxCommentsBeforeCollapse: o,
        onFocus: l,
        onBlur: c,
        tabIndex: 0
      }
    );
  }
);
function Ii(e, t, n) {
  if (t === "recent-activity")
    return e.sort(
      (o, r) => r.comments[r.comments.length - 1].createdAt.getTime() - o.comments[o.comments.length - 1].createdAt.getTime()
    );
  if (t === "oldest")
    return e.sort(
      (o, r) => o.createdAt.getTime() - r.createdAt.getTime()
    );
  if (t === "position")
    return e.sort((o, r) => {
      var s, d;
      const l = ((s = n == null ? void 0 : n.get(o.id)) == null ? void 0 : s.from) || Number.MAX_VALUE, c = ((d = n == null ? void 0 : n.get(r.id)) == null ? void 0 : d.from) || Number.MAX_VALUE;
      return l - c;
    });
  throw new dt(t);
}
function it(e, t) {
  return e.transact((n) => {
    if (!t)
      return "Original content deleted";
    if (n.doc.nodeSize < t.to)
      return "";
    const o = n.doc.textBetween(
      t.from,
      t.to
    );
    return o.length > 15 ? `${o.slice(0, 15)}…` : o;
  });
}
function il(e) {
  const t = C();
  if (!t.comments)
    throw new Error("Comments plugin not found");
  const n = Z(
    t.comments.onUpdate.bind(t.comments)
  ), o = n == null ? void 0 : n.selectedThreadId, r = _t(t), l = y(() => {
    const c = Array.from(r.values()), s = Ii(
      c,
      e.sort || "position",
      n == null ? void 0 : n.threadPositions
    ), d = [];
    for (const a of s)
      a.resolved ? (e.filter === "resolved" || e.filter === "all") && d.push({
        thread: a,
        referenceText: it(
          t,
          n == null ? void 0 : n.threadPositions.get(a.id)
        )
      }) : (e.filter === "open" || e.filter === "all") && d.push({
        thread: a,
        referenceText: it(
          t,
          n == null ? void 0 : n.threadPositions.get(a.id)
        )
      });
    return d;
  }, [r, n == null ? void 0 : n.threadPositions, e.filter, e.sort, t]);
  return /* @__PURE__ */ i("div", { className: "bn-threads-sidebar", children: l.map((c) => /* @__PURE__ */ i(
    Ei,
    {
      thread: c.thread,
      selectedThreadId: o,
      editor: t,
      referenceText: c.referenceText,
      maxCommentsBeforeCollapse: e.maxCommentsBeforeCollapse
    },
    c.thread.id
  )) });
}
function ll(e) {
  const t = D();
  if (e || (e = t == null ? void 0 : t.editor), !e)
    throw new Error(
      "'editor' is required, either from BlockNoteContext or as a function argument"
    );
  const n = e, [o, r] = w(() => n.getActiveStyles());
  return ee(() => {
    r(n.getActiveStyles());
  }, n), ge(() => {
    r(n.getActiveStyles());
  }, n), o;
}
function Ni() {
  const [, e] = w(0);
  return () => e((t) => t + 1);
}
const cl = (e) => {
  const t = Ni();
  x(() => {
    const n = () => {
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          t();
        });
      });
    };
    return e.on("transaction", n), () => {
      e.off("transaction", n);
    };
  }, [e]);
};
function Pi(e) {
  return e.currentTarget instanceof HTMLElement && e.relatedTarget instanceof HTMLElement ? e.currentTarget.contains(e.relatedTarget) : !1;
}
function al({
  onBlur: e,
  onFocus: t
} = {}) {
  const n = N(null), [o, r] = w(!1), l = N(!1), c = (a) => {
    r(a), l.current = a;
  }, s = (a) => {
    l.current || (c(!0), t == null || t(a));
  }, d = (a) => {
    l.current && !Pi(a) && (c(!1), e == null || e(a));
  };
  return x(() => {
    const a = n.current;
    if (a)
      return a.addEventListener("focusin", s), a.addEventListener("focusout", d), () => {
        a == null || a.removeEventListener("focusin", s), a == null || a.removeEventListener("focusout", d);
      };
  }, [s, d]), { ref: n, focused: o };
}
function Zi(e) {
  return (
    // Creates inline content section element
    /* @__PURE__ */ i(
      gt,
      {
        as: "span",
        className: "bn-inline-content-section",
        "data-inline-content-type": e.inlineContentType,
        ...Object.fromEntries(
          Object.entries(e.inlineContentProps).filter(([t, n]) => {
            const o = e.propSchema[t];
            return n !== o.default;
          }).map(([t, n]) => [st(t), n])
        ),
        children: e.children
      }
    )
  );
}
function sl(e, t) {
  const n = Ee({
    name: e.type,
    inline: !0,
    group: "inline",
    selectable: e.content === "styled",
    atom: e.content === "none",
    content: e.content === "styled" ? "inline*" : "",
    addAttributes() {
      return at(e.propSchema);
    },
    addKeyboardShortcuts() {
      return In(e);
    },
    parseHTML() {
      return En(e);
    },
    renderHTML({ node: o }) {
      const r = this.options.editor, l = je(
        o,
        r.schema.inlineContentSchema,
        r.schema.styleSchema
      ), c = t.render, s = de(
        (d) => /* @__PURE__ */ i(
          c,
          {
            inlineContent: l,
            updateInlineContent: () => {
            },
            contentRef: d
          }
        ),
        r
      );
      return Rn(
        s,
        e.type,
        o.attrs,
        e.propSchema
      );
    },
    // TODO: needed?
    addNodeView() {
      const o = this.options.editor;
      return (r) => mt(
        (l) => {
          const c = ht().nodeViewContentRef;
          if (!c)
            throw new Error("nodeViewContentRef is not set");
          const s = t.render;
          return /* @__PURE__ */ i(
            Zi,
            {
              inlineContentProps: l.node.attrs,
              inlineContentType: e.type,
              propSchema: e.propSchema,
              children: /* @__PURE__ */ i(
                s,
                {
                  contentRef: c,
                  inlineContent: je(
                    l.node,
                    o.schema.inlineContentSchema,
                    o.schema.styleSchema
                  ),
                  updateInlineContent: (d) => {
                    const a = _n(
                      [d],
                      o.pmSchema
                    );
                    o.transact(
                      (u) => u.replaceWith(
                        l.getPos(),
                        l.getPos() + l.node.nodeSize,
                        a
                      )
                    );
                  }
                }
              )
            }
          );
        },
        {
          className: "bn-ic-react-node-view-renderer",
          as: "span"
          // contentDOMElementTag: "span", (requires tt upgrade)
        }
      )(r);
    }
  });
  return Nn(e, {
    node: n
  });
}
var Y, Ve;
class Di {
  constructor({
    mark: t,
    view: n,
    inline: o,
    options: r,
    editor: l
    // BlockNote specific
  }) {
    Ue(this, Y);
    L(this, "dom");
    L(this, "contentDOM");
    L(this, "mark");
    L(this, "view");
    L(this, "inline");
    L(this, "options");
    L(this, "editor");
    L(this, "shouldIgnoreMutation", (t) => !this.dom || !this.contentDOM ? !0 : t.type === "selection" ? !1 : this.contentDOM === t.target && t.type === "attributes" ? !0 : !this.contentDOM.contains(t.target));
    L(this, "ignoreMutation", (t) => {
      if (!this.dom || !this.contentDOM) return !0;
      let n;
      const o = this.options.ignoreMutation;
      return o && (n = o(t)), typeof n != "boolean" && (n = this.shouldIgnoreMutation(t)), n;
    });
    this.mark = t, this.view = n, this.inline = o, this.options = r, this.editor = l, this.dom = this.createDOM(r.as), this.contentDOM = r.contentAs ? this.createContentDOM(r.contentAs) : void 0, this.dom.setAttribute("data-mark-view-root", "true"), this.contentDOM && (this.contentDOM.setAttribute("data-mark-view-content", "true"), this.contentDOM.style.whiteSpace = "inherit");
  }
  createDOM(t) {
    return ke(this, Y, Ve).call(this, t);
  }
  createContentDOM(t) {
    return ke(this, Y, Ve).call(this, t);
  }
  get component() {
    return this.options.component;
  }
  destroy() {
    var t, n, o;
    (n = (t = this.options).destroy) == null || n.call(t), this.dom.remove(), (o = this.contentDOM) == null || o.remove();
  }
}
Y = new WeakSet(), Ve = function(t) {
  const { inline: n, mark: o } = this;
  return t == null ? document.createElement(n ? "span" : "div") : t instanceof HTMLElement ? t : t instanceof Function ? t(o) : document.createElement(t);
};
class Oi extends Di {
  constructor() {
    super(...arguments);
    // implements ReactRenderer<MarkViewContext>
    // key: string = nanoid();
    L(this, "id", Math.floor(Math.random() * 4294967295).toString());
    L(this, "context", {
      contentRef: (n) => {
        n && this.contentDOM && n.firstChild !== this.contentDOM && n.appendChild(this.contentDOM);
      },
      view: this.view,
      mark: this.mark
    });
    L(this, "updateContext", () => {
      Object.assign(this.context, {
        mark: this.mark
      });
    });
    // render = () => {
    //   const UserComponent = this.component;
    //   return createPortal(
    //     <markViewContext.Provider value={this.context}>
    //       <UserComponent />
    //     </markViewContext.Provider>,
    //     this.dom,
    //     this.key
    //   );
    // };
    L(this, "render", () => {
      this.editor._tiptapEditor.contentComponent.setRenderer(
        this.id,
        this.renderer()
      );
    });
    L(this, "destroy", () => {
      super.destroy(), this.editor._tiptapEditor.contentComponent.removeRenderer(this.id);
    });
    L(this, "renderer", () => {
      const n = this.component, o = {};
      return this.mark.attrs.stringValue && (o.value = this.mark.attrs.stringValue), {
        reactElement: (
          // <markViewContext.Provider value={this.context}>
          /* @__PURE__ */ i(n, { contentRef: this.context.contentRef, ...o })
        ),
        element: this.dom
      };
    });
  }
}
function dl(e, t) {
  const n = Fn.create({
    name: e.type,
    addAttributes() {
      return Dn(e.propSchema);
    },
    parseHTML() {
      return Zn(e);
    },
    renderHTML({ mark: o }) {
      const r = {};
      e.propSchema === "string" && (r.value = o.attrs.stringValue);
      const l = t.render, c = de(
        (s) => /* @__PURE__ */ i(l, { ...r, contentRef: s }),
        this.options.editor
      );
      return Pn(
        c,
        e.type,
        o.attrs.stringValue,
        e.propSchema
      );
    }
  });
  return n.config.addMarkView = (o) => (r, l) => {
    const c = new Oi({
      editor: o,
      inline: !0,
      mark: r,
      options: {
        component: t.render,
        contentAs: "span"
      },
      view: l
    });
    return c.render(), c;
  }, On(e, {
    mark: n
  });
}
function ul(e, t) {
  const n = e.getBoundingClientRect(), o = t.getBoundingClientRect(), r = n.top < o.top, l = n.bottom > o.bottom;
  return r && l ? "both" : r ? "top" : l ? "bottom" : "none";
}
export {
  pr as AddBlockButton,
  nt as AddButton,
  rr as AddCommentButton,
  Ci as AddFileButton,
  ir as AddTiptapCommentButton,
  vi as AudioBlock,
  ki as AudioPreview,
  wi as AudioToExternalHTML,
  re as BasicTextStyleButton,
  wr as BlockColorsItem,
  He as BlockContentWrapper,
  ft as BlockNoteContext,
  ii as BlockNoteDefaultUI,
  hi as BlockNoteViewEditor,
  Yi as BlockNoteViewRaw,
  or as BlockTypeSelect,
  ei as ColorPickerButton,
  qo as ColorStyleButton,
  Zo as Comment,
  Do as Comments,
  zn as ComponentsContext,
  Ko as CreateLinkButton,
  Ur as DeleteButton,
  mr as DeleteLinkButton,
  xr as DragHandleButton,
  yr as DragHandleMenu,
  hr as EditLinkButton,
  Et as EditLinkMenuItems,
  Fo as EmbedTab,
  rl as ExperimentalMobileFormattingToolbarController,
  Gr as ExtendButton,
  Fe as FigureWithCaption,
  Mi as FileBlock,
  Ae as FileBlockWrapper,
  Xo as FileCaptionButton,
  Yo as FileDeleteButton,
  lr as FileDownloadButton,
  pi as FileNameWithIcon,
  Rt as FilePanel,
  Go as FilePanelController,
  cr as FilePreviewButton,
  Jo as FileRenameButton,
  Qo as FileReplaceButton,
  Hi as FileToExternalHTML,
  qn as FloatingComposer,
  $n as FloatingComposerController,
  Oo as FloatingThreadController,
  It as FormattingToolbar,
  ur as FormattingToolbarController,
  Rr as GridSuggestionMenuController,
  _r as GridSuggestionMenuWrapper,
  Vi as ImageBlock,
  yi as ImagePreview,
  xi as ImageToExternalHTML,
  Zi as InlineContentWrapper,
  fr as LinkToolbar,
  br as LinkToolbarController,
  pe as LinkWithCaption,
  er as NestBlockButton,
  gr as OpenLinkButton,
  Ji as ReactAudioBlock,
  Qi as ReactFileBlock,
  el as ReactImageBlock,
  nl as ReactVideoBlock,
  vr as RemoveBlockItem,
  Ft as ResizableFileBlockWrapper,
  Vr as SideMenu,
  Br as SideMenuController,
  ti as SplitButton,
  Fr as SuggestionMenuController,
  Zr as SuggestionMenuWrapper,
  oi as TableCellButton,
  ni as TableCellMenu,
  ar as TableCellMergeButton,
  Mr as TableColumnHeaderItem,
  $r as TableHandle,
  qr as TableHandleMenu,
  ri as TableHandlesController,
  Hr as TableRowHeaderItem,
  we as TextAlignButton,
  Lt as Thread,
  il as ThreadsSidebar,
  ol as ToggleWrapper,
  tr as UnnestBlockButton,
  Ao as UploadTab,
  _i as VideoBlock,
  Si as VideoPreview,
  Li as VideoToExternalHTML,
  nr as blockTypeSelectItems,
  Ce as createReactBlockSpec,
  sl as createReactInlineContentSpec,
  dl as createReactStyleSpec,
  ul as elementOverflow,
  Tr as getDefaultReactEmojiPickerItems,
  Or as getDefaultReactSlashMenuItems,
  dr as getFormattingToolbarItems,
  tl as getPageBreakReactSlashMenuItems,
  it as getReferenceText,
  zo as mergeRefs,
  ll as useActiveStyles,
  $i as useBlockNote,
  D as useBlockNoteContext,
  C as useBlockNoteEditor,
  Pt as useCloseSuggestionMenuNoItems,
  p as useComponentsContext,
  fe as useCreateBlockNote,
  M as useDictionary,
  ee as useEditorChange,
  U as useEditorContentOrSelectionChange,
  cl as useEditorForceUpdate,
  Gn as useEditorSelectionBoundingBox,
  ge as useEditorSelectionChange,
  Kr as useExtendButtonsPositioning,
  al as useFocusWithin,
  Lr as useGridSuggestionMenuKeyboardNavigation,
  Zt as useLoadSuggestionMenuItems,
  fi as useOnUploadEnd,
  bi as useOnUploadStart,
  li as usePrefersColorScheme,
  Oe as useResolveUrl,
  E as useSelectedBlocks,
  Ir as useSuggestionMenuKeyboardHandler,
  Pr as useSuggestionMenuKeyboardNavigation,
  Qr as useTableHandlesPositioning,
  _t as useThreads,
  G as useUIElementPositioning,
  Z as useUIPluginState,
  Ot as useUploadLoading,
  No as useUser,
  De as useUsers
};
//# sourceMappingURL=blocknote-react.js.map
